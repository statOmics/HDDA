<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Adapted by Milan Malfait and Leo Fuhrhop" />


<title>Lab 4: Sparse PCA and LDA</title>

<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.13.2/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<script src="site_libs/navigation-1.1/sourceembed.js"></script>
<link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>
<link href="site_libs/font-awesome-6.5.2/css/all.min.css" rel="stylesheet" />
<link href="site_libs/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>



<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #204a87; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #204a87; font-weight: bold; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #ce5c00; font-weight: bold; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */

.sourceCode .row {
  width: 100%;
}
.sourceCode {
  overflow-x: auto;
}
.code-folding-btn {
  margin-right: -30px;
}
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>


<style type="text/css">
#rmd-source-code {
  display: none;
}
</style>

<style type="text/css">
/* for pandoc --citeproc since 2.11 */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">HDDA</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fa fa-chalkboard-teacher"></span>
     
    Lectures
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="intro.html">1. Introduction</a>
    </li>
    <li>
      <a href="svd.html">2. Singular Value Decomposition</a>
    </li>
    <li>
      <a href="prediction.html">3. Prediction with High Dimensional Predictors</a>
    </li>
    <li>
      <a href="sparseSvd.html">4. Sparse Singular Value Decomposition</a>
    </li>
    <li>
      <a href="lda.html">5. Linear Discriminant Analysis</a>
    </li>
    <li>
      <a href="hclust.html">6.1. Introduction to Clustering</a>
    </li>
    <li>
      <a href="https://sites.stat.washington.edu/people/raftery/Research/PDF/fraley1998.pdf">6.2. Paper Model-based Clustering</a>
    </li>
    <li>
      <a href="em.html">6.3. EM algorithm</a>
    </li>
    <li>
      <a href="lsi.html">7. Large Scale Inference</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fa fa-laptop"></span>
     
    Labs
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="Lab1-Intro-SVD.html">Lab 1: Intro &amp; SVD</a>
    </li>
    <li>
      <a href="Lab2-PCA.html">Lab 2: SVD - PCA</a>
    </li>
    <li>
      <a href="Lab3-Penalized-Regression.html">Lab 3: Prediction</a>
    </li>
    <li>
      <a href="Lab4-Sparse-PCA-LDA.html">Lab 4: Sparse PCA &amp; LDA</a>
    </li>
    <li>
      <a href="Lab5-Clustering.html">Lab 5: Clustering</a>
    </li>
    <li>
      <a href="Lab6-Large-Scale-Inference.html">Lab 6: LSI</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="about.html">About</a>
</li>
<li>
  <a href="https://github.com/statOmics/HDDA">
    <span class="fab fa-github"></span>
     
  </a>
</li>
<li>
  <a href="http://statomics.github.io/">statOmics</a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">

<div class="btn-group pull-right float-right">
<button type="button" class="btn btn-default btn-xs btn-secondary btn-sm dropdown-toggle" data-toggle="dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu dropdown-menu-right" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
<li role="separator" class="divider"></li>
<li><a id="rmd-download-source" href="#">Download Rmd</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Lab 4: Sparse PCA and LDA</h1>
<h3 class="subtitle">High Dimensional Data Analysis practicals</h3>
<h4 class="author">Adapted by Milan Malfait and Leo Fuhrhop</h4>
<h4 class="date">18 Nov 2021 <br/> (Last updated: 2025-11-06)</h4>

</div>


<div id="change-log" class="section level3 unnumbered">
<h3><a href="https://github.com/statOmics/HDDA/commits/master/Lab4-Sparse-PCA-LDA.Rmd">Change log</a></h3>
<hr />
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="do">## install packages with:</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="co"># install.packages(c(&quot;glmnet&quot;, &quot;MASS&quot;, &quot;ggplot2&quot;, &quot;gridExtra&quot;, &quot;ggpubr&quot;))</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="co"># if (!requireNamespace(&quot;remotes&quot;, quietly = TRUE)) {</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="co">#     install.packages(&quot;remotes&quot;)</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="co"># remotes::install_github(&quot;statOmics/HDDAData&quot;)</span></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="fu">library</span>(glmnet)</span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a><span class="fu">library</span>(MASS)</span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a><span class="fu">library</span>(HDDAData)</span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a><span class="fu">library</span>(gridExtra)</span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a><span class="fu">library</span>(ggpubr)</span></code></pre></div>
</div>
<div id="introduction" class="section level1" number="1">
<h1><span class="header-section-number">1</span> Introduction</h1>
<p><strong>In this lab session we will look at the following topics</strong></p>
<ul>
<li>Methods to set some of the loadings exactly to zero in a PCA</li>
<li>Use <code>glmnet()</code> to add penalties on principal component loadings</li>
<li>Use LDA to understand differences between groups in a high dimensional space</li>
</ul>
<div id="the-dataset" class="section level2 unnumbered">
<h2>The dataset</h2>
<p>In this practical session, we use the dataset by <span class="citation">Alon et al. (1999)</span> on gene
expression levels in 40 tumour and 22 normal colon tissue samples. They checked
a total of 6500 human genes using the Affymetrix oligonucleotide array.</p>
<p>You can load the data in as follows:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;Alon1999&quot;</span>)</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="fu">str</span>(Alon1999[, <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>])</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="co">#&gt; &#39;data.frame&#39;:    62 obs. of  10 variables:</span></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="co">#&gt;  $ Y : chr  &quot;t&quot; &quot;n&quot; &quot;t&quot; &quot;n&quot; ...</span></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a><span class="co">#&gt;  $ X1: num  8589 9164 3826 6246 3230 ...</span></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a><span class="co">#&gt;  $ X2: num  5468 6720 6970 7824 3694 ...</span></span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a><span class="co">#&gt;  $ X3: num  4263 4883 5370 5956 3401 ...</span></span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a><span class="co">#&gt;  $ X4: num  4065 3718 4706 3976 3464 ...</span></span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a><span class="co">#&gt;  $ X5: num  1998 2015 1167 2003 2181 ...</span></span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a><span class="co">#&gt;  $ X6: num  5282 5570 1572 2131 2923 ...</span></span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a><span class="co">#&gt;  $ X7: num  2170 3849 1325 1531 2069 ...</span></span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a><span class="co">#&gt;  $ X8: num  2773 2793 1472 1715 2949 ...</span></span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a><span class="co">#&gt;  $ X9: num  7526 7018 3297 3870 3303 ...</span></span>
<span id="cb2-14"><a href="#cb2-14" tabindex="-1"></a><span class="fu">dim</span>(Alon1999)</span>
<span id="cb2-15"><a href="#cb2-15" tabindex="-1"></a><span class="co">#&gt; [1]   62 2001</span></span>
<span id="cb2-16"><a href="#cb2-16" tabindex="-1"></a><span class="fu">table</span>(Alon1999<span class="sc">$</span>Y)</span>
<span id="cb2-17"><a href="#cb2-17" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb2-18"><a href="#cb2-18" tabindex="-1"></a><span class="co">#&gt;  n  t </span></span>
<span id="cb2-19"><a href="#cb2-19" tabindex="-1"></a><span class="co">#&gt; 22 40</span></span></code></pre></div>
<p>The dataset contains one variable named <code>Y</code> with the values <code>t</code> and <code>n</code>. This
variable indicates whether the sample came from tumourous (<code>t</code>) or normal (<code>n</code>)
tissue. For more information on this dataset, see <code>?Alon1999</code>.</p>
<p>The goal of this practical is to find the best subset / combination of genes to detect tumourous tissue.
As in <span class="citation">Alon et al. (1999)</span>, we use the 2000 genes with the highest minimal intensity
across the samples.</p>
</div>
</div>
<div id="sparse-pca" class="section level1" number="2">
<h1><span class="header-section-number">2</span> Sparse PCA</h1>
<p>Begin by constructing the data matrix <code>X</code>, which contains the centered and scaled predictors,
and the response variable <code>Y</code> as a binary factor.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">scale</span>(Alon1999[, <span class="sc">-</span><span class="dv">1</span>], <span class="at">center =</span> <span class="cn">TRUE</span>, <span class="at">scale =</span> <span class="cn">TRUE</span>)</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>Y <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(Alon1999[, <span class="dv">1</span>])</span></code></pre></div>
<p>Use these objects to solve the following exercises.</p>
<div id="tasks" class="section level2 unnumbered">
<h2>Tasks</h2>
<div id="perform-a-svd-on-x-and-store-the-scores-of-the-pcs." class="section level5 unnumbered">
<h5>1. Perform a SVD on <code>X</code> and store the scores of the PCs.</h5>
<details>
<summary>
Solution
</summary>
<p>Using <code>svd</code>:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>svd_X <span class="ot">&lt;-</span> <span class="fu">svd</span>(X)</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>Z <span class="ot">&lt;-</span> svd_X<span class="sc">$</span>u <span class="sc">%*%</span> <span class="fu">diag</span>(svd_X<span class="sc">$</span>d) <span class="co"># Calculate the scores</span></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>V <span class="ot">&lt;-</span> svd_X<span class="sc">$</span>v                 <span class="co"># Calculate the loadings</span></span></code></pre></div>
<p>Using <code>prcomp</code>:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="co"># X is already centered and scaled so no need to do again</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>pca_x <span class="ot">&lt;-</span> <span class="fu">prcomp</span>(X, <span class="at">center =</span> <span class="cn">FALSE</span>, <span class="at">scale. =</span> <span class="cn">FALSE</span>)</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a><span class="co"># The scores are given by `pca_x$x`, the loadings are `pca_x$rotation`</span></span></code></pre></div>
</details>
</div>
<div id="produce-a-scree-plot-and-confirm-that-the-first-and-second-pcs-can-approximate-the-data-to-some-extent." class="section level5 unnumbered">
<h5>2. Produce a scree plot and confirm that the first and second PCs can approximate the data to some extent.</h5>
<p>Recall from <a href="https://statomics.github.io/HDDA/Lab2-PCA.html#Tasks">Lab 2</a> that a scree plot displays the proportion of variance explained by each PC.</p>
<details>
<summary>
Solution
</summary>
<p>Calculate the proportion of variance explained by each PC.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>var_explained <span class="ot">&lt;-</span> pca_x<span class="sc">$</span>sdev<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> <span class="fu">sum</span>(pca_x<span class="sc">$</span>sdev<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="co"># alternative: svd_X$d^2 / sum(svd_X$d^2)</span></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a><span class="co"># Create dataframe for plotting</span></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>prop_var <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">PC =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(pca_x<span class="sc">$</span>x), <span class="at">Var =</span> var_explained)</span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a><span class="co"># alternative: PC = ncol(Z)</span></span></code></pre></div>
<p>Visualize with a scree plot using <code>ggplot2</code>:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="fu">ggplot</span>(prop_var, <span class="fu">aes</span>(PC, Var)) <span class="sc">+</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fl">2.5</span>, <span class="at">col =</span> <span class="st">&quot;firebrick&quot;</span>) <span class="sc">+</span></span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">60</span>, <span class="at">by =</span> <span class="dv">5</span>)) <span class="sc">+</span></span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Proportion of variance&quot;</span>,</span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Proportion of variance explained by each PC&quot;</span></span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="Lab4-Sparse-PCA-LDA_files/figure-html/pca-scree-ggplot-1.png" width="100%" style="display: block; margin: auto;" /></p>
<p>Alternatively, using base <code>R</code> plotting:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="fu">plot</span>(prop_var<span class="sc">$</span>PC, prop_var<span class="sc">$</span>Var,</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">&quot;b&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Proportion of variance&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;PC&quot;</span>,</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>)</span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a><span class="fu">title</span>(<span class="st">&quot;Proportion of variance explained by each PC&quot;</span>)</span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="fl">2.5</span>, <span class="at">col =</span> <span class="st">&quot;firebrick&quot;</span>)</span></code></pre></div>
<p><img src="Lab4-Sparse-PCA-LDA_files/figure-html/pca-scree-plot-1.png" width="100%" style="display: block; margin: auto;" /></p>
<p>About 55% of the variance in the data are explained by the first and second PCs.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="fu">cumsum</span>(prop_var<span class="sc">$</span>Var)[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a><span class="co">#&gt;  [1] 0.4495565 0.5480190 0.6156694 0.6722213 0.7050558 0.7363469 0.7596658</span></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a><span class="co">#&gt;  [8] 0.7818428 0.7985138 0.8140390</span></span></code></pre></div>
</details>
</div>
<div id="plot-the-first-two-pcs-and-use-different-colours-for-tumor-normal-tissue." class="section level5 unnumbered">
<h5>3. Plot the first two PCs and use different colours for tumor / normal tissue.</h5>
<p>Due to the large number of features, the biplot would be difficult to interpret. A simple scatterplot, separated by tumor / normal tissue, is more informative in this setting.</p>
<details>
<summary>
Solution
</summary>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a>scores_1_2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">PC1 =</span> pca_x<span class="sc">$</span>x[, <span class="dv">1</span>], <span class="at">PC2 =</span> pca_x<span class="sc">$</span>x[, <span class="dv">2</span>], <span class="at">Tissue =</span> Y)</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a><span class="co"># Alternative: retrieve scores from Z[, 1], Z[, 2]</span></span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a><span class="fu">ggplot</span>(scores_1_2, <span class="fu">aes</span>(PC1, PC2)) <span class="sc">+</span></span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">col =</span> Tissue), <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;deepskyblue2&quot;</span>, <span class="st">&quot;coral1&quot;</span>)) <span class="sc">+</span></span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="fl">0.8</span>, <span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span>)</span></code></pre></div>
<p><img src="Lab4-Sparse-PCA-LDA_files/figure-html/pca-tissue-ggplot-1.png" width="100%" style="display: block; margin: auto;" /></p>
<p>Alternatively, using base <code>R</code> plotting:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;n&quot;</span> <span class="ot">=</span> <span class="st">&quot;deepskyblue2&quot;</span>, <span class="st">&quot;t&quot;</span> <span class="ot">=</span> <span class="st">&quot;coral1&quot;</span>)</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a><span class="fu">plot</span>(scores_1_2<span class="sc">$</span>PC1, scores_1_2<span class="sc">$</span>PC2,</span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a>  <span class="at">col =</span> cols[Y],</span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">&quot;PC1&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;PC2&quot;</span>, <span class="at">pch =</span> <span class="dv">19</span></span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a>)</span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topleft&quot;</span>, <span class="fu">c</span>(<span class="st">&quot;Normal&quot;</span>, <span class="st">&quot;Tumor&quot;</span>),</span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a>  <span class="at">col =</span> cols,</span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a>  <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">title =</span> <span class="st">&quot;Tissue&quot;</span></span>
<span id="cb11-9"><a href="#cb11-9" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="Lab4-Sparse-PCA-LDA_files/figure-html/pca-tissue-plot-1.png" width="100%" style="display: block; margin: auto;" /></p>
<p><strong>Interpretation:</strong> using only the first 2 PCs does not seem to separate the tumor and normal cases clearly.</p>
</details>
</div>
<div id="plot-histograms-of-the-loadings-of-the-first-and-second-pcs.-interpret." class="section level5 unnumbered">
<h5>4. Plot histograms of the loadings of the first and second PCs. Interpret.</h5>
<details>
<summary>
Solution
</summary>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a>loadings_1_2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a>  <span class="at">loadings_1 =</span> pca_x<span class="sc">$</span>rotation[, <span class="dv">1</span>], <span class="at">loadings_2 =</span> pca_x<span class="sc">$</span>rotation[, <span class="dv">2</span>]</span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a>)</span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a><span class="co"># alternative: loadings_1 = V[, 1], loadings_2 = V[, 2]</span></span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a><span class="co"># First plot (PC1)</span></span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(loadings_1_2, <span class="fu">aes</span>(<span class="at">x =</span> loadings_1)) <span class="sc">+</span></span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">50</span>, <span class="at">fill =</span> <span class="st">&quot;grey80&quot;</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a>  <span class="fu">geom_vline</span>(</span>
<span id="cb12-10"><a href="#cb12-10" tabindex="-1"></a>    <span class="at">xintercept =</span> <span class="fu">quantile</span>(loadings_1_2<span class="sc">$</span>loadings_1, <span class="fl">0.95</span>),</span>
<span id="cb12-11"><a href="#cb12-11" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;firebrick&quot;</span>,</span>
<span id="cb12-12"><a href="#cb12-12" tabindex="-1"></a>    <span class="at">linewidth =</span> <span class="fl">1.2</span></span>
<span id="cb12-13"><a href="#cb12-13" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb12-14"><a href="#cb12-14" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;PC 1 loadings&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Count&quot;</span>, <span class="at">title =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb12-15"><a href="#cb12-15" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>)</span>
<span id="cb12-16"><a href="#cb12-16" tabindex="-1"></a></span>
<span id="cb12-17"><a href="#cb12-17" tabindex="-1"></a><span class="co"># Second plot (PC2)</span></span>
<span id="cb12-18"><a href="#cb12-18" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(loadings_1_2, <span class="fu">aes</span>(<span class="at">x =</span> loadings_2)) <span class="sc">+</span></span>
<span id="cb12-19"><a href="#cb12-19" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">50</span>, <span class="at">fill =</span> <span class="st">&quot;grey80&quot;</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb12-20"><a href="#cb12-20" tabindex="-1"></a>  <span class="fu">geom_vline</span>(</span>
<span id="cb12-21"><a href="#cb12-21" tabindex="-1"></a>    <span class="at">xintercept =</span> <span class="fu">quantile</span>(loadings_1_2<span class="sc">$</span>loadings_2, <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.95</span>)),</span>
<span id="cb12-22"><a href="#cb12-22" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;firebrick&quot;</span>,</span>
<span id="cb12-23"><a href="#cb12-23" tabindex="-1"></a>    <span class="at">linewidth =</span> <span class="fl">1.2</span></span>
<span id="cb12-24"><a href="#cb12-24" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb12-25"><a href="#cb12-25" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;PC 2 loadings&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Count&quot;</span>, <span class="at">title =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb12-26"><a href="#cb12-26" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>)</span>
<span id="cb12-27"><a href="#cb12-27" tabindex="-1"></a></span>
<span id="cb12-28"><a href="#cb12-28" tabindex="-1"></a><span class="co"># Arrange plots vertically</span></span>
<span id="cb12-29"><a href="#cb12-29" tabindex="-1"></a><span class="fu">grid.arrange</span>(p1, p2, <span class="at">ncol =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="Lab4-Sparse-PCA-LDA_files/figure-html/pca-loading-ggplot-1.png" width="100%" style="display: block; margin: auto;" /></p>
<p>Alternatively, using base <code>R</code> plotting:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>))</span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a><span class="co"># First plot (PC1)</span></span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a><span class="fu">hist</span>(loadings_1_2<span class="sc">$</span>loadings_1, <span class="at">breaks =</span> <span class="dv">50</span>, <span class="at">xlab =</span> <span class="st">&quot;PC 1 loadings&quot;</span>, <span class="at">main =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a><span class="co"># Add vertical line at 95% quantile</span></span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="fu">quantile</span>(loadings_1_2<span class="sc">$</span>loadings_1, <span class="fl">0.95</span>), <span class="at">col =</span> <span class="st">&quot;firebrick&quot;</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a><span class="co"># Second plot (PC2)</span></span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a><span class="fu">hist</span>(loadings_1_2<span class="sc">$</span>loadings_2, <span class="at">breaks =</span> <span class="dv">50</span>, <span class="at">xlab =</span> <span class="st">&quot;PC 2 loadings&quot;</span>, <span class="at">main =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb13-10"><a href="#cb13-10" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="fu">c</span>(</span>
<span id="cb13-11"><a href="#cb13-11" tabindex="-1"></a>  <span class="fu">quantile</span>(loadings_1_2<span class="sc">$</span>loadings_2, <span class="fl">0.05</span>),</span>
<span id="cb13-12"><a href="#cb13-12" tabindex="-1"></a>  <span class="fu">quantile</span>(loadings_1_2<span class="sc">$</span>loadings_2, <span class="fl">0.95</span>)</span>
<span id="cb13-13"><a href="#cb13-13" tabindex="-1"></a>), <span class="at">col =</span> <span class="st">&quot;firebrick&quot;</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="Lab4-Sparse-PCA-LDA_files/figure-html/pca-loadings-plot-1.png" width="100%" style="display: block; margin: auto;" /></p>
<p>Vertical lines were added at the 95th percentile for PC1 and the 5th and 95th percentiles for PC2 to reflect where the largest (in absolute value) loadings are situated (no negative loadings for PC1, so only showing the 95th percentile).</p>
<p><strong>Interpretation:</strong> remember that the PC loadings reflect the <em>contributions</em> of each feature (in this case: gene) to the PC.
From these histograms it should be clear that only a minor fraction of the genes are really driving these first 2 PCs, especially for PC2 (where the bulk of genes has loadings close to 0).</p>
</details>
<p>We know that the first PC <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ùêô</mi><mn>ùüè</mn></msub><annotation encoding="application/x-tex">\mathbf{Z_1}</annotation></semantics></math> is given by
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ùêô</mi><mn>ùüè</mn></msub><mo>=</mo><mi>ùêó</mi><msub><mi>ùêï</mi><mn>ùüè</mn></msub><mspace width="0.167em"></mspace><mo>,</mo></mrow><annotation encoding="application/x-tex">
\mathbf{Z_1}=\mathbf{X} \mathbf{V_1} \, ,
</annotation></semantics></math></p>
<p>where <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ùêï</mi><mn>ùüè</mn></msub><annotation encoding="application/x-tex">\mathbf{V_1}</annotation></semantics></math> are the loadings of the first PC. By setting <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ùõÉ</mi><mo>=</mo><msub><mi>ùêï</mi><mn>ùüè</mn></msub></mrow><annotation encoding="application/x-tex">\boldsymbol{\beta} = \mathbf{V_1}</annotation></semantics></math> and <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi><mo>=</mo><msub><mi>Z</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">Y = Z_1</annotation></semantics></math>, we can express this as the regression</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ùêò</mi><mo>=</mo><mi>ùêó</mi><mi>ùõÉ</mi><mspace width="0.167em"></mspace><mi>.</mi></mrow><annotation encoding="application/x-tex">
\mathbf{Y}=\mathbf{X}\boldsymbol{\beta} \, .
</annotation></semantics></math></p>
<p>Recall that the ridge regression solution for <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ùõÉ</mi><annotation encoding="application/x-tex">\boldsymbol{\beta}</annotation></semantics></math> is given by</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ùõÉ</mi><mtext mathvariant="normal">ridge</mtext></msub><mo>=</mo><msup><mrow><mo stretchy="true" form="prefix">(</mo><mrow><msup><mi>ùêó</mi><mi>ùêì</mi></msup><mi>ùêó</mi></mrow><mo>+</mo><mi>Œª</mi><mi>ùêà</mi><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mi>‚àí</mi><mn>1</mn></mrow></msup><msup><mi>ùêó</mi><mi>T</mi></msup><mi>ùêò</mi><mspace width="0.167em"></mspace><mi>.</mi></mrow><annotation encoding="application/x-tex">
\boldsymbol{\beta}_{\text{ridge}} = (\mathbf{X^TX}+\lambda\mathbf{I})^{-1}\mathbf{X}^T\mathbf Y \, .
</annotation></semantics></math></p>
</div>
<div id="replace-mathbfy-with-mathbfz_1-and-verify-numerically-in-r-that" class="section level5 unnumbered">
<h5>5. Replace <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ùêò</mi><annotation encoding="application/x-tex">\mathbf{Y}</annotation></semantics></math> with <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ùêô</mi><mn>ùüè</mn></msub><annotation encoding="application/x-tex">\mathbf{Z_1}</annotation></semantics></math> and verify numerically in <code>R</code> that</h5>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ùêï</mi><mn>1</mn></msub><mo>=</mo><mfrac><msub><mi>ùõÉ</mi><mtext mathvariant="normal">ridge</mtext></msub><mrow><mo stretchy="false" form="postfix">‚à•</mo><msub><mi>ùõÉ</mi><mtext mathvariant="normal">ridge</mtext></msub><msub><mo stretchy="false" form="postfix">‚à•</mo><mn>2</mn></msub></mrow></mfrac><mspace width="0.167em"></mspace><mi>.</mi></mrow><annotation encoding="application/x-tex">
  \mathbf V_1 =
    \frac{\boldsymbol\beta_{\text{ridge}}}{\|\boldsymbol\beta_{\text{ridge}}\|_2} \, .
  </annotation></semantics></math></p>
<p>You may use any <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Œª</mi><mo>&gt;</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\lambda &gt; 0</annotation></semantics></math> of your choice. Remember that <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false" form="postfix">‚à•</mo><msub><mi>ùõÉ</mi><mtext mathvariant="normal">ridge</mtext></msub><msub><mo stretchy="false" form="postfix">‚à•</mo><mn>2</mn></msub><mo>=</mo><msqrt><mrow><msubsup><mi>ùõÉ</mi><mtext mathvariant="normal">ridge</mtext><mi>T</mi></msubsup><msub><mi>ùõÉ</mi><mtext mathvariant="normal">ridge</mtext></msub></mrow></msqrt><mo>=</mo><msqrt><mrow><msubsup><mo>‚àë</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>p</mi></msubsup><msubsup><mi>Œ≤</mi><mi>j</mi><mn>2</mn></msubsup></mrow></msqrt></mrow><annotation encoding="application/x-tex">\|\boldsymbol\beta_{\text{ridge}}\|_2 = \sqrt{\boldsymbol\beta_{\text{ridge}}^T \boldsymbol\beta_{\text{ridge}}} = \sqrt{\sum_{j=1}^p \beta_j^2}</annotation></semantics></math>.</p>
<details>
<summary>
Solution
</summary>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">dim</span>(X)[<span class="dv">2</span>]</span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a>tXX_lambda_I <span class="ot">&lt;-</span> <span class="fu">t</span>(X) <span class="sc">%*%</span> X <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fu">diag</span>(p)</span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a><span class="co"># This might take a while to calculate</span></span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a>beta_ridge <span class="ot">&lt;-</span> <span class="fu">solve</span>(tXX_lambda_I) <span class="sc">%*%</span> <span class="fu">t</span>(X) <span class="sc">%*%</span> Z[, <span class="dv">1</span>]</span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a>mag_beta_ridge <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">sum</span>(beta_ridge<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a><span class="fu">max</span>(<span class="fu">abs</span>(V[, <span class="dv">1</span>] <span class="sc">-</span> beta_ridge <span class="sc">/</span> mag_beta_ridge))</span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a><span class="co">#&gt; [1] 2.15872e-10</span></span>
<span id="cb14-8"><a href="#cb14-8" tabindex="-1"></a><span class="co"># alternative for V[, 1]: pca_x$rotation[, 1]</span></span></code></pre></div>
<p>For a visual comparison, we can also plot
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ùõÉ</mi><mtext mathvariant="normal">ridge</mtext></msub><mi>/</mi><mo stretchy="false" form="postfix">‚à•</mo><msub><mi>ùõÉ</mi><mtext mathvariant="normal">ridge</mtext></msub><msub><mo stretchy="false" form="postfix">‚à•</mo><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">\boldsymbol\beta_{\text{ridge}} / \|\boldsymbol\beta_{\text{ridge}}\|_2</annotation></semantics></math>
against the loadings <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ùêï</mi><mn>1</mn></msub><annotation encoding="application/x-tex">\mathbf V_1</annotation></semantics></math>.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a><span class="fu">plot</span>(V[, <span class="dv">1</span>], beta_ridge <span class="sc">/</span> mag_beta_ridge,</span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="fu">expression</span>(<span class="st">&quot;V&quot;</span>[<span class="dv">1</span>]),</span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a>  <span class="at">ylab =</span> <span class="fu">expression</span>(beta[<span class="st">&quot;ridge&quot;</span>] <span class="sc">/</span> <span class="fu">paste</span>(<span class="st">&quot;||&quot;</span>, beta, <span class="st">&quot;||&quot;</span>)[<span class="dv">2</span>]),</span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a>  <span class="at">pch =</span> <span class="dv">19</span></span>
<span id="cb15-7"><a href="#cb15-7" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="Lab4-Sparse-PCA-LDA_files/figure-html/beta_ridge-vs-V1-plot-1.png" width="100%" style="display: block; margin: auto;" /></p>
</details>
<p>You have now seen that the loadings of the PCs can be computed from ridge regression coefficients.</p>
<p>If we introduce an additional <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>L</mi><mn>1</mn></msub><annotation encoding="application/x-tex">L_1</annotation></semantics></math> penalty on the <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ùõÉ</mi><annotation encoding="application/x-tex">\boldsymbol \beta</annotation></semantics></math> coefficients, we move from ridge regression to elastic net regression. Recall that elastic net regression minimizes the criterion
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false" form="postfix">‚à•</mo><mi>ùêò</mi><mo>‚àí</mo><mi>ùêó</mi><mi>ùõÉ</mi><msubsup><mo stretchy="false" form="postfix">‚à•</mo><mn>2</mn><mn>2</mn></msubsup><mo>+</mo><mi>Œ±</mi><mi>Œª</mi><mo stretchy="false" form="postfix">‚à•</mo><mi>ùõÉ</mi><msub><mo stretchy="false" form="postfix">‚à•</mo><mn>1</mn></msub><mo>+</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>‚àí</mo><mi>Œ±</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>Œª</mi><mo stretchy="false" form="postfix">‚à•</mo><mi>ùõÉ</mi><msubsup><mo stretchy="false" form="postfix">‚à•</mo><mn>2</mn><mn>2</mn></msubsup></mrow><annotation encoding="application/x-tex">
\|\mathbf Y-\mathbf{X}\boldsymbol \beta\|^2_2 +  \alpha \lambda\|\boldsymbol \beta\|_1 + (1 - \alpha) \lambda\|\boldsymbol \beta\|^2_2
</annotation></semantics></math>
for <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Œ±</mi><mo>‚àà</mo><mrow><mo stretchy="true" form="prefix">[</mo><mn>0</mn><mo>,</mo><mn>1</mn><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex">\alpha \in [0,1]</annotation></semantics></math>. Whenever <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Œ±</mi><mo>&gt;</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\alpha &gt; 0</annotation></semantics></math>, a sufficiently large <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œª</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math> forces some of the coefficients in <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ùõÉ</mi><annotation encoding="application/x-tex">\boldsymbol\beta</annotation></semantics></math> to become zero.</p>
<p>Regressing the principal component <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Z</mi><mn>1</mn></msub><annotation encoding="application/x-tex">Z_1</annotation></semantics></math> on <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>X</mi><annotation encoding="application/x-tex">X</annotation></semantics></math> therefore sets some of the loadings <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>V</mi><mn>1</mn></msub><annotation encoding="application/x-tex">V_1</annotation></semantics></math> to zero. This means that elastic net can be used to implement sparse PCA.</p>
</div>
<div id="fit-an-elastic-net-model-for-z_1.-use-alpha-0.5-and-lambda-c11-1.75-0.3.-determine-the-number-of-non-zero-loadings-for-each-choice-of-lambda.-repeat-the-same-steps-for-z_2-but-use-lambda-c5-1.5-0.15." class="section level5 unnumbered">
<h5>6. Fit an elastic net model for <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Z</mi><mn>1</mn></msub><annotation encoding="application/x-tex">Z_1</annotation></semantics></math>. Use <code>alpha = 0.5</code> and <code>lambda = c(11, 1.75, 0.3)</code>. Determine the number of non-zero loadings for each choice of <code>lambda</code>. Repeat the same steps for <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Z</mi><mn>2</mn></msub><annotation encoding="application/x-tex">Z_2</annotation></semantics></math>, but use <code>lambda = c(5, 1.5, 0.15)</code>.</h5>
<details>
<summary>
Solution
</summary>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="co"># Helper function to determine number of non-zero loadings</span></span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a>num_loadings <span class="ot">&lt;-</span> <span class="cf">function</span>(fit) {</span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a>  lambdas <span class="ot">&lt;-</span> fit<span class="sc">$</span>lambda</span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a>  num_nonzero <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a>  <span class="cf">for</span> (lambda <span class="cf">in</span> lambdas) {</span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a>    num_nonzero <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb16-7"><a href="#cb16-7" tabindex="-1"></a>      num_nonzero, <span class="fu">sum</span>(<span class="fu">as.vector</span>(<span class="fu">coef</span>(fit, <span class="at">s =</span> lambda))[<span class="sc">-</span><span class="dv">1</span>] <span class="sc">!=</span> <span class="dv">0</span>)</span>
<span id="cb16-8"><a href="#cb16-8" tabindex="-1"></a>    )</span>
<span id="cb16-9"><a href="#cb16-9" tabindex="-1"></a>  }</span>
<span id="cb16-10"><a href="#cb16-10" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">data.frame</span>(lambdas, num_nonzero))</span>
<span id="cb16-11"><a href="#cb16-11" tabindex="-1"></a>}</span>
<span id="cb16-12"><a href="#cb16-12" tabindex="-1"></a></span>
<span id="cb16-13"><a href="#cb16-13" tabindex="-1"></a><span class="co"># Elastic net for Z_1</span></span>
<span id="cb16-14"><a href="#cb16-14" tabindex="-1"></a>fit_loadings1 <span class="ot">&lt;-</span> <span class="fu">glmnet</span>(X, Z[, <span class="dv">1</span>], <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">lambda =</span> <span class="fu">c</span>(<span class="dv">11</span>, <span class="fl">1.75</span>, <span class="fl">0.3</span>))</span>
<span id="cb16-15"><a href="#cb16-15" tabindex="-1"></a><span class="fu">num_loadings</span>(fit_loadings1)</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["lambdas"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["num_nonzero"],"name":[2],"type":["int"],"align":["right"]}],"data":[{"1":"11.00","2":"64"},{"1":"1.75","2":"99"},{"1":"0.30","2":"144"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a></span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a><span class="co"># Elastic net for Z_2</span></span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a>fit_loadings2 <span class="ot">&lt;-</span> <span class="fu">glmnet</span>(X, Z[, <span class="dv">2</span>], <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">lambda =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="fl">1.5</span>, <span class="fl">0.15</span>))</span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a><span class="fu">num_loadings</span>(fit_loadings2)</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["lambdas"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["num_nonzero"],"name":[2],"type":["int"],"align":["right"]}],"data":[{"1":"5.00","2":"44"},{"1":"1.50","2":"64"},{"1":"0.15","2":"105"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</details>
</div>
<div id="plot-the-resulting-sparse-first-and-second-pcs-and-use-different-colors-for-tumor-normal-tissue.-how-well-do-these-new-pcs-separate-the-response-classes" class="section level5 unnumbered">
<h5>7. Plot the resulting sparse first and second PCs and use different colors for tumor / normal tissue. How well do these new PCs separate the response classes?</h5>
<p>You may reuse the code from task 3 to produce 3 new plots for <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Œª</mi><mtext mathvariant="normal">PC1</mtext></msub><mo>=</mo><mn>11</mn><mo>,</mo><msub><mi>Œª</mi><mtext mathvariant="normal">PC2</mtext></msub><mo>=</mo><mn>5</mn><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(\lambda_{\text{PC1}} = 11, \lambda_{\text{PC2}} = 5)</annotation></semantics></math>, <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Œª</mi><mtext mathvariant="normal">PC1</mtext></msub><mo>=</mo><mn>1.75</mn><mo>,</mo><msub><mi>Œª</mi><mtext mathvariant="normal">PC2</mtext></msub><mo>=</mo><mn>1.5</mn><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(\lambda_{\text{PC1}} = 1.75, \lambda_{\text{PC2}} = 1.5)</annotation></semantics></math> and <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Œª</mi><mtext mathvariant="normal">PC1</mtext></msub><mo>=</mo><mn>0.3</mn><mo>,</mo><msub><mi>Œª</mi><mtext mathvariant="normal">PC2</mtext></msub><mo>=</mo><mn>0.15</mn><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(\lambda_{\text{PC1}} = 0.3, \lambda_{\text{PC2}} = 0.15)</annotation></semantics></math>. Compare this to the plot for the original PCs from task 3 and interpret.</p>
<details>
<summary>
Solution
</summary>
<p>Using base <code>R</code> plotting:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="co"># Helper function for scatterplot between two sparse PCs</span></span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a>plot_sparse_PCA <span class="ot">&lt;-</span> <span class="cf">function</span>(loadings1, loadings2) {</span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a>  nonzero1 <span class="ot">&lt;-</span> <span class="fu">sum</span>(loadings1[<span class="sc">-</span><span class="dv">1</span>] <span class="sc">!=</span> <span class="dv">0</span>)</span>
<span id="cb18-4"><a href="#cb18-4" tabindex="-1"></a>  nonzero2 <span class="ot">&lt;-</span> <span class="fu">sum</span>(loadings2[<span class="sc">-</span><span class="dv">1</span>] <span class="sc">!=</span> <span class="dv">0</span>)</span>
<span id="cb18-5"><a href="#cb18-5" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" tabindex="-1"></a>  SPC1 <span class="ot">&lt;-</span> X <span class="sc">%*%</span> loadings1[<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb18-7"><a href="#cb18-7" tabindex="-1"></a>  SPC2 <span class="ot">&lt;-</span> X <span class="sc">%*%</span> loadings2[<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb18-8"><a href="#cb18-8" tabindex="-1"></a></span>
<span id="cb18-9"><a href="#cb18-9" tabindex="-1"></a>  <span class="fu">plot</span>(</span>
<span id="cb18-10"><a href="#cb18-10" tabindex="-1"></a>    SPC1, SPC2, <span class="at">col =</span> cols[Y], <span class="at">xlab =</span> <span class="st">&quot;SPC1&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;SPC2&quot;</span>, <span class="at">pch =</span> <span class="dv">16</span>,</span>
<span id="cb18-11"><a href="#cb18-11" tabindex="-1"></a>    <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">40</span>, <span class="dv">40</span>), <span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">60</span>, <span class="dv">95</span>),</span>
<span id="cb18-12"><a href="#cb18-12" tabindex="-1"></a>    <span class="at">main =</span> <span class="fu">paste</span>(nonzero1, <span class="st">&quot;genes for SPC1,&quot;</span>, nonzero2, <span class="st">&quot;for SPC2&quot;</span>)</span>
<span id="cb18-13"><a href="#cb18-13" tabindex="-1"></a>  )</span>
<span id="cb18-14"><a href="#cb18-14" tabindex="-1"></a>  <span class="fu">legend</span>(</span>
<span id="cb18-15"><a href="#cb18-15" tabindex="-1"></a>    <span class="st">&quot;topleft&quot;</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;Normal tissue&quot;</span>, <span class="st">&quot;Tumor tissue&quot;</span>),</span>
<span id="cb18-16"><a href="#cb18-16" tabindex="-1"></a>    <span class="at">bty =</span> <span class="st">&quot;n&quot;</span>, <span class="at">col =</span> cols, <span class="at">pch =</span> <span class="fu">c</span>(<span class="dv">16</span>, <span class="dv">16</span>), <span class="at">cex =</span> <span class="dv">1</span></span>
<span id="cb18-17"><a href="#cb18-17" tabindex="-1"></a>  )</span>
<span id="cb18-18"><a href="#cb18-18" tabindex="-1"></a>}</span>
<span id="cb18-19"><a href="#cb18-19" tabindex="-1"></a></span>
<span id="cb18-20"><a href="#cb18-20" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb18-21"><a href="#cb18-21" tabindex="-1"></a><span class="fu">plot</span>(Z[, <span class="dv">1</span>], Z[, <span class="dv">2</span>],</span>
<span id="cb18-22"><a href="#cb18-22" tabindex="-1"></a>  <span class="at">col =</span> cols[Y], <span class="at">xlab =</span> <span class="st">&quot;PC1&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;PC2&quot;</span>, <span class="at">pch =</span> <span class="dv">16</span>,</span>
<span id="cb18-23"><a href="#cb18-23" tabindex="-1"></a>  <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">40</span>, <span class="dv">40</span>), <span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">60</span>, <span class="dv">95</span>),</span>
<span id="cb18-24"><a href="#cb18-24" tabindex="-1"></a>  <span class="at">main =</span> <span class="st">&quot;All 2000 genes </span><span class="sc">\n</span><span class="st">for PC1 and PC2&quot;</span></span>
<span id="cb18-25"><a href="#cb18-25" tabindex="-1"></a>)</span>
<span id="cb18-26"><a href="#cb18-26" tabindex="-1"></a><span class="fu">legend</span>(</span>
<span id="cb18-27"><a href="#cb18-27" tabindex="-1"></a>  <span class="st">&quot;topleft&quot;</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;Normal tissue&quot;</span>, <span class="st">&quot;Tumor tissue&quot;</span>),</span>
<span id="cb18-28"><a href="#cb18-28" tabindex="-1"></a>  <span class="at">bty =</span> <span class="st">&quot;n&quot;</span>, <span class="at">col =</span> cols, <span class="at">pch =</span> <span class="fu">c</span>(<span class="dv">16</span>, <span class="dv">16</span>), <span class="at">cex =</span> <span class="dv">1</span></span>
<span id="cb18-29"><a href="#cb18-29" tabindex="-1"></a>)</span>
<span id="cb18-30"><a href="#cb18-30" tabindex="-1"></a><span class="fu">plot_sparse_PCA</span>(</span>
<span id="cb18-31"><a href="#cb18-31" tabindex="-1"></a>  <span class="fu">as.vector</span>(<span class="fu">coef</span>(fit_loadings1, <span class="at">s =</span> <span class="fl">0.3</span>)),</span>
<span id="cb18-32"><a href="#cb18-32" tabindex="-1"></a>  <span class="fu">as.vector</span>(<span class="fu">coef</span>(fit_loadings2, <span class="at">s =</span> <span class="fl">0.15</span>))</span>
<span id="cb18-33"><a href="#cb18-33" tabindex="-1"></a>)</span>
<span id="cb18-34"><a href="#cb18-34" tabindex="-1"></a><span class="fu">plot_sparse_PCA</span>(</span>
<span id="cb18-35"><a href="#cb18-35" tabindex="-1"></a>  <span class="fu">as.vector</span>(<span class="fu">coef</span>(fit_loadings1, <span class="at">s =</span> <span class="fl">1.75</span>)),</span>
<span id="cb18-36"><a href="#cb18-36" tabindex="-1"></a>  <span class="fu">as.vector</span>(<span class="fu">coef</span>(fit_loadings2, <span class="at">s =</span> <span class="fl">1.5</span>))</span>
<span id="cb18-37"><a href="#cb18-37" tabindex="-1"></a>)</span>
<span id="cb18-38"><a href="#cb18-38" tabindex="-1"></a><span class="fu">plot_sparse_PCA</span>(</span>
<span id="cb18-39"><a href="#cb18-39" tabindex="-1"></a>  <span class="fu">as.vector</span>(<span class="fu">coef</span>(fit_loadings1, <span class="at">s =</span> <span class="dv">11</span>)),</span>
<span id="cb18-40"><a href="#cb18-40" tabindex="-1"></a>  <span class="fu">as.vector</span>(<span class="fu">coef</span>(fit_loadings2, <span class="at">s =</span> <span class="dv">6</span>))</span>
<span id="cb18-41"><a href="#cb18-41" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="Lab4-Sparse-PCA-LDA_files/figure-html/sparse-PCA-plots-1.png" width="100%" style="display: block; margin: auto;" /></p>
<p>Alternatively, using <code>ggplot</code>:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="co"># Helper function for scatterplot between two sparse PCs</span></span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a>plot_sparse_PCA <span class="ot">&lt;-</span> <span class="cf">function</span>(loadings1, loadings2) {</span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a>  nonzero1 <span class="ot">&lt;-</span> <span class="fu">sum</span>(loadings1[<span class="sc">-</span><span class="dv">1</span>] <span class="sc">!=</span> <span class="dv">0</span>)</span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a>  nonzero2 <span class="ot">&lt;-</span> <span class="fu">sum</span>(loadings2[<span class="sc">-</span><span class="dv">1</span>] <span class="sc">!=</span> <span class="dv">0</span>)</span>
<span id="cb19-5"><a href="#cb19-5" tabindex="-1"></a></span>
<span id="cb19-6"><a href="#cb19-6" tabindex="-1"></a>  SPC1 <span class="ot">&lt;-</span> X <span class="sc">%*%</span> loadings1[<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb19-7"><a href="#cb19-7" tabindex="-1"></a>  SPC2 <span class="ot">&lt;-</span> X <span class="sc">%*%</span> loadings2[<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb19-8"><a href="#cb19-8" tabindex="-1"></a></span>
<span id="cb19-9"><a href="#cb19-9" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">data.frame</span>(SPC1, SPC2, <span class="at">Tissue =</span> Y), <span class="fu">aes</span>(SPC1, SPC2)) <span class="sc">+</span></span>
<span id="cb19-10"><a href="#cb19-10" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">col =</span> Tissue), <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb19-11"><a href="#cb19-11" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;deepskyblue2&quot;</span>, <span class="st">&quot;coral1&quot;</span>)) <span class="sc">+</span></span>
<span id="cb19-12"><a href="#cb19-12" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">paste</span>(nonzero1, <span class="st">&quot;genes for SPC1,&quot;</span>, nonzero2, <span class="st">&quot;for SPC2&quot;</span>)) <span class="sc">+</span></span>
<span id="cb19-13"><a href="#cb19-13" tabindex="-1"></a>    <span class="fu">xlim</span>(<span class="sc">-</span><span class="dv">60</span>, <span class="dv">95</span>) <span class="sc">+</span></span>
<span id="cb19-14"><a href="#cb19-14" tabindex="-1"></a>    <span class="fu">ylim</span>(<span class="sc">-</span><span class="dv">40</span>, <span class="dv">40</span>) <span class="sc">+</span></span>
<span id="cb19-15"><a href="#cb19-15" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb19-16"><a href="#cb19-16" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>, <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>))</span>
<span id="cb19-17"><a href="#cb19-17" tabindex="-1"></a>}</span>
<span id="cb19-18"><a href="#cb19-18" tabindex="-1"></a></span>
<span id="cb19-19"><a href="#cb19-19" tabindex="-1"></a>plot1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(scores_1_2, <span class="fu">aes</span>(PC1, PC2)) <span class="sc">+</span></span>
<span id="cb19-20"><a href="#cb19-20" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">col =</span> Tissue), <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb19-21"><a href="#cb19-21" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;deepskyblue2&quot;</span>, <span class="st">&quot;coral1&quot;</span>)) <span class="sc">+</span></span>
<span id="cb19-22"><a href="#cb19-22" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;All 2000 genes for PC1 and PC2&quot;</span>) <span class="sc">+</span></span>
<span id="cb19-23"><a href="#cb19-23" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="sc">-</span><span class="dv">60</span>, <span class="dv">95</span>) <span class="sc">+</span></span>
<span id="cb19-24"><a href="#cb19-24" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="sc">-</span><span class="dv">40</span>, <span class="dv">40</span>) <span class="sc">+</span></span>
<span id="cb19-25"><a href="#cb19-25" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb19-26"><a href="#cb19-26" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>, <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>))</span>
<span id="cb19-27"><a href="#cb19-27" tabindex="-1"></a>plot2 <span class="ot">&lt;-</span> <span class="fu">plot_sparse_PCA</span>(</span>
<span id="cb19-28"><a href="#cb19-28" tabindex="-1"></a>  <span class="fu">as.vector</span>(<span class="fu">coef</span>(fit_loadings1, <span class="at">s =</span> <span class="fl">0.3</span>)),</span>
<span id="cb19-29"><a href="#cb19-29" tabindex="-1"></a>  <span class="fu">as.vector</span>(<span class="fu">coef</span>(fit_loadings2, <span class="at">s =</span> <span class="fl">0.15</span>))</span>
<span id="cb19-30"><a href="#cb19-30" tabindex="-1"></a>)</span>
<span id="cb19-31"><a href="#cb19-31" tabindex="-1"></a>plot3 <span class="ot">&lt;-</span> <span class="fu">plot_sparse_PCA</span>(</span>
<span id="cb19-32"><a href="#cb19-32" tabindex="-1"></a>  <span class="fu">as.vector</span>(<span class="fu">coef</span>(fit_loadings1, <span class="at">s =</span> <span class="fl">1.75</span>)),</span>
<span id="cb19-33"><a href="#cb19-33" tabindex="-1"></a>  <span class="fu">as.vector</span>(<span class="fu">coef</span>(fit_loadings2, <span class="at">s =</span> <span class="fl">1.5</span>))</span>
<span id="cb19-34"><a href="#cb19-34" tabindex="-1"></a>)</span>
<span id="cb19-35"><a href="#cb19-35" tabindex="-1"></a>plot4 <span class="ot">&lt;-</span> <span class="fu">plot_sparse_PCA</span>(</span>
<span id="cb19-36"><a href="#cb19-36" tabindex="-1"></a>  <span class="fu">as.vector</span>(<span class="fu">coef</span>(fit_loadings1, <span class="at">s =</span> <span class="dv">11</span>)),</span>
<span id="cb19-37"><a href="#cb19-37" tabindex="-1"></a>  <span class="fu">as.vector</span>(<span class="fu">coef</span>(fit_loadings2, <span class="at">s =</span> <span class="dv">6</span>))</span>
<span id="cb19-38"><a href="#cb19-38" tabindex="-1"></a>)</span>
<span id="cb19-39"><a href="#cb19-39" tabindex="-1"></a></span>
<span id="cb19-40"><a href="#cb19-40" tabindex="-1"></a><span class="fu">ggarrange</span>(plot1, plot2, plot3, plot4)</span></code></pre></div>
<p><img src="Lab4-Sparse-PCA-LDA_files/figure-html/ggplot-spc-1.png" width="100%" style="display: block; margin: auto;" /></p>
<p><strong>Conclusion:</strong> Sparse PCA has succeeded in setting the uninformative genes / loadings to zero.
In separating normal and tumour tissues, SPCA performs vitually the same as PCA. By increasing <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œª</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math>, more sparsity is induced in the loadings, while the overall visual impression remains comparable.
The key point here is that SPCA uses only a minor proportion of the original features to achieve the same results, suggesting that the largest variability of the data is only driven by a minority of features.</p>
</details>
<p><strong>Remark:</strong> Oftentimes, <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œª</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math> is chosen in such a way that a particular number or range of nonzero loadings is obtained. This is how we proceeded above, where we considered a sequence of <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œª</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math>‚Äôs resulting in different levels of sparsity.
Alternatively, if you want to select <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œª</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math> in a data-driven manner, you <em>cannot</em> rely on cross-validation with the predictive MSE as used in <a href="https://statomics.github.io/HDDA/Lab3-Penalized-Regression.html#9_Exercise:_evaluate_and_compare_prediction_models">Lab 3</a>. The reason for this is that the minimal cross-validated MSE will be achieved for <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Œª</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\lambda = 0</annotation></semantics></math> (or the smallest positive value that can be evaluated without numerical problems).
Instead, you can take a look at the proportion of variance that is explained by the sparse PCs to select a sensible number of nonzero loadings or a sensible <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œª</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math>.</p>
</div>
</div>
</div>
<div id="lda" class="section level1" number="3">
<h1><span class="header-section-number">3</span> LDA</h1>
<p>In this section, we will perform LDA on the data by <span class="citation">Alon et al. (1999)</span> to get a clear understanding on the genes responsible for separating the tumor and normal tissue groups.</p>
<p>Remember that the LDA problem can be stated as</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ùêØ</mi><mo>=</mo><msub><mtext mathvariant="normal">ArgMax</mtext><mi>a</mi></msub><mfrac><mrow><msup><mi>ùêö</mi><mi>ùêì</mi></msup><mi>ùêÅ</mi><mi>ùêö</mi></mrow><mrow><msup><mi>ùêö</mi><mi>ùêì</mi></msup><mi>ùêñ</mi><mi>ùêö</mi></mrow></mfrac><mrow><mspace width="0.333em"></mspace><mtext mathvariant="normal"> subject to </mtext><mspace width="0.333em"></mspace></mrow><mrow><msup><mi>ùêö</mi><mi>ùêì</mi></msup><mi>ùêñ</mi><mi>ùêö</mi></mrow><mo>=</mo><mn>1</mn><mspace width="0.167em"></mspace><mo>,</mo></mrow><annotation encoding="application/x-tex">
\mathbf{v}
  = \text{ArgMax}_a \frac{\mathbf{a^T B a}}{\mathbf{a^T W a}}
    \text{ subject to }
    \mathbf{a^T W a} = 1 \, ,
</annotation></semantics></math></p>
<p>which is equivalent to the eigenvalue / eigenvector problem</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>ùêñ</mi><mrow><mi>‚àí</mi><mn>1</mn></mrow></msup><mi>ùêÅ</mi><mi>ùêö</mi><mo>=</mo><mi>Œª</mi><mi>ùêö</mi><mspace width="0.167em"></mspace><mi>.</mi></mrow><annotation encoding="application/x-tex">
\mathbf W^{-1} \mathbf B \mathbf a=\lambda \mathbf a \, .
</annotation></semantics></math></p>
<p>In our case, where we only have two groups, only one solution exists.
This is the eigenvector <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo>=</mo><mi>ùêØ</mi></mrow><annotation encoding="application/x-tex">a = \mathbf v</annotation></semantics></math> and its eigenvalue.
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ùêØ</mi><annotation encoding="application/x-tex">\mathbf v</annotation></semantics></math> can can be interpreted in terms of which predictors are important to discriminate between the two classes.
We can then write the scores as</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ùêô</mi><mo>=</mo><mi>ùêó</mi><mi>ùêØ</mi><mspace width="0.167em"></mspace><mi>.</mi></mrow><annotation encoding="application/x-tex">
\mathbf Z=\mathbf X \mathbf v \, .
</annotation></semantics></math></p>
<div id="tasks-1" class="section level2 unnumbered">
<h2>Tasks</h2>
<div id="use-the-lda-function-from-the-mass-package-to-fit-an-lda-on-x-with-grouping-y." class="section level5 unnumbered">
<h5>1. Use the <code>lda()</code> function from the <code>MASS</code> package to fit an LDA on <code>X</code> with grouping <code>Y</code>.</h5>
<p>Note that the <code>grouping</code> has to be a factor variable.</p>
<details>
<summary>
Solution
</summary>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a>alon_lda <span class="ot">&lt;-</span> <span class="fu">lda</span>(<span class="at">x =</span> X, <span class="at">grouping =</span> Y)</span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a><span class="co">#&gt; Warning in lda.default(x, grouping, ...): variables are collinear</span></span>
<span id="cb20-3"><a href="#cb20-3" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" tabindex="-1"></a><span class="co"># alternative: Y ~ X</span></span></code></pre></div>
<p>Note the warning regarding collinearity.</p>
</details>
</div>
<div id="extract-mathbf-v-from-the-lda-object." class="section level5 unnumbered">
<h5>2. Extract <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ùêØ</mi><annotation encoding="application/x-tex">\mathbf v</annotation></semantics></math> from the <code>lda</code> object.</h5>
<p>Hint: Have a look at the ‚ÄúValue‚Äù section of <code>?lda</code>.</p>
<details>
<summary>
Solution
</summary>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a>V1 <span class="ot">&lt;-</span> alon_lda<span class="sc">$</span>scaling</span></code></pre></div>
</details>
</div>
<div id="compute-mathbf-z." class="section level5 unnumbered">
<h5>3. Compute <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ùêô</mi><annotation encoding="application/x-tex">\mathbf Z</annotation></semantics></math>.</h5>
<details>
<summary>
Solution
</summary>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a>Z1 <span class="ot">&lt;-</span> X <span class="sc">%*%</span> V1</span></code></pre></div>
</details>
</div>
<div id="plot-the-scores-mathbf-z-against-the-response-to-see-how-well-the-lda-separates-the-tumour-and-normal-tissues-groups.-interpret-your-plot." class="section level5 unnumbered">
<h5>4. Plot the scores <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ùêô</mi><annotation encoding="application/x-tex">\mathbf Z</annotation></semantics></math> against the response to see how well the LDA separates the tumour and normal tissues groups. Interpret your plot.</h5>
<p>Hint: A boxplot would be an appropriate visualization, but feel free to be creative.</p>
<details>
<summary>
Solution
</summary>
<p>Using <code>ggplot</code>:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">data.frame</span>(Z1, Y), <span class="fu">aes</span>(<span class="at">x =</span> Y, <span class="at">y =</span> Z1, <span class="at">fill =</span> <span class="fu">as.factor</span>(Y))) <span class="sc">+</span></span>
<span id="cb23-2"><a href="#cb23-2" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb23-3"><a href="#cb23-3" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> cols) <span class="sc">+</span></span>
<span id="cb23-4"><a href="#cb23-4" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Y&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Z&quot;</span>,</span>
<span id="cb23-5"><a href="#cb23-5" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Separation of normal and tumour samples by LDA&quot;</span></span>
<span id="cb23-6"><a href="#cb23-6" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb23-7"><a href="#cb23-7" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb23-8"><a href="#cb23-8" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>, <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span></code></pre></div>
<p><img src="Lab4-Sparse-PCA-LDA_files/figure-html/LDA-ggboxplot-1.png" width="100%" style="display: block; margin: auto;" /></p>
<p>Alternatively, using base <code>R</code> plotting:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb24-2"><a href="#cb24-2" tabindex="-1"></a><span class="fu">boxplot</span>(</span>
<span id="cb24-3"><a href="#cb24-3" tabindex="-1"></a>  Z1 <span class="sc">~</span> Y, <span class="at">col =</span> cols, <span class="at">ylab =</span> <span class="st">&quot;Z&quot;</span>,</span>
<span id="cb24-4"><a href="#cb24-4" tabindex="-1"></a>  <span class="at">main =</span> <span class="st">&quot;Separation of normal and tumour samples by LDA&quot;</span></span>
<span id="cb24-5"><a href="#cb24-5" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="Lab4-Sparse-PCA-LDA_files/figure-html/LDA-boxplot-1.png" width="100%" style="display: block; margin: auto;" /></p>
<p><strong>Interpretation</strong>: The LDA can separate the tumour and normal tissue samples very well. In comparison, the first and second components of the (sparse) PCA (an unsupervised method) in the first part of this Lab did not discriminate the two groups nearly as well.</p>
</details>
<p>We can view
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ùêô</mi><mo>=</mo><mi>ùêó</mi><mi>ùêØ</mi></mrow><annotation encoding="application/x-tex">
\mathbf Z = \mathbf X \mathbf v
</annotation></semantics></math>
as a regression of <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ùêô</mi><annotation encoding="application/x-tex">\mathbf Z</annotation></semantics></math> on <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ùêó</mi><annotation encoding="application/x-tex">\mathbf X</annotation></semantics></math> with coefficient vector <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ùêØ</mi><annotation encoding="application/x-tex">\mathbf v</annotation></semantics></math>. The entries of <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ùêØ</mi><annotation encoding="application/x-tex">\mathbf v</annotation></semantics></math> are non-zero for all genes.
To implement a sparse LDA, where some of the entries of <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ùêØ</mi><annotation encoding="application/x-tex">\mathbf v</annotation></semantics></math> are set to zero, we can introduce an <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>L</mi><mn>1</mn></msub><annotation encoding="application/x-tex">L_1</annotation></semantics></math> penalty on <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ùêØ</mi><annotation encoding="application/x-tex">\mathbf v</annotation></semantics></math> and fit a Lasso regression.
The resulting <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ùêØ</mi><annotation encoding="application/x-tex">\mathbf v</annotation></semantics></math> will only be determined by a few interesting genes instead of all 2000.</p>
</div>
<div id="fit-a-lasso-model-for-mathbf-z-with-lambda-c0.1-0.01-0.001.-determine-the-number-of-non-zero-loadings-for-each-choice-of-lambda." class="section level5 unnumbered">
<h5>5. Fit a Lasso model for <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ùêô</mi><annotation encoding="application/x-tex">\mathbf Z</annotation></semantics></math> with <code>lambda = c(0.1, 0.01, 0.001)</code>. Determine the number of non-zero loadings for each choice of <code>lambda</code>.</h5>
<details>
<summary>
Solution
</summary>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a>lda_loadings <span class="ot">&lt;-</span> <span class="fu">glmnet</span>(X, Z1, <span class="at">alpha =</span> <span class="dv">1</span>, <span class="at">lambda =</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.02</span>, <span class="fl">0.002</span>))</span>
<span id="cb25-2"><a href="#cb25-2" tabindex="-1"></a><span class="fu">num_loadings</span>(lda_loadings)</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["lambdas"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["num_nonzero"],"name":[2],"type":["int"],"align":["right"]}],"data":[{"1":"0.200","2":"18"},{"1":"0.020","2":"52"},{"1":"0.002","2":"108"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</details>
</div>
<div id="plot-the-resulting-sparse-scores-against-the-response.-are-the-smaller-subsets-of-genes-as-effective-in-separating-the-tumour-and-normal-tissue-groups-as-the-entire-set-of-genes" class="section level5 unnumbered">
<h5>6. Plot the resulting sparse scores against the response. Are the smaller subsets of genes as effective in separating the tumour and normal tissue groups as the entire set of genes?</h5>
<p>You may reuse the code from task 4 to produce 3 new plots, one for each choice of <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œª</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math>. Compare this to the plot for the original LDA from task 4 and interpret.</p>
<details>
<summary>
Solution
</summary>
<p>Using base <code>R</code> plotting:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a><span class="co"># Helper function for scatterplot between two sparse PCs</span></span>
<span id="cb26-2"><a href="#cb26-2" tabindex="-1"></a>plot_sparse_LDA <span class="ot">&lt;-</span> <span class="cf">function</span>(loadings) {</span>
<span id="cb26-3"><a href="#cb26-3" tabindex="-1"></a>  n_nonzero <span class="ot">&lt;-</span> <span class="fu">sum</span>(loadings[<span class="sc">-</span><span class="dv">1</span>] <span class="sc">!=</span> <span class="dv">0</span>)</span>
<span id="cb26-4"><a href="#cb26-4" tabindex="-1"></a>  SLDA <span class="ot">&lt;-</span> X <span class="sc">%*%</span> loadings[<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb26-5"><a href="#cb26-5" tabindex="-1"></a></span>
<span id="cb26-6"><a href="#cb26-6" tabindex="-1"></a>  <span class="fu">boxplot</span>(</span>
<span id="cb26-7"><a href="#cb26-7" tabindex="-1"></a>    SLDA <span class="sc">~</span> Y, <span class="at">col =</span> cols, <span class="at">ylab =</span> <span class="st">&quot;Z&quot;</span>,</span>
<span id="cb26-8"><a href="#cb26-8" tabindex="-1"></a>    <span class="at">main =</span> <span class="fu">sprintf</span>(<span class="st">&quot;Subset of %d genes&quot;</span>, n_nonzero),</span>
<span id="cb26-9"><a href="#cb26-9" tabindex="-1"></a>    <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">4</span>, <span class="dv">4</span>)</span>
<span id="cb26-10"><a href="#cb26-10" tabindex="-1"></a>  )</span>
<span id="cb26-11"><a href="#cb26-11" tabindex="-1"></a>}</span>
<span id="cb26-12"><a href="#cb26-12" tabindex="-1"></a></span>
<span id="cb26-13"><a href="#cb26-13" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb26-14"><a href="#cb26-14" tabindex="-1"></a><span class="fu">boxplot</span>(</span>
<span id="cb26-15"><a href="#cb26-15" tabindex="-1"></a>  Z1 <span class="sc">~</span> Y, <span class="at">col =</span> cols, <span class="at">ylab =</span> <span class="st">&quot;Z&quot;</span>,</span>
<span id="cb26-16"><a href="#cb26-16" tabindex="-1"></a>  <span class="at">main =</span> <span class="st">&quot;Entire set of 2000 genes&quot;</span>,</span>
<span id="cb26-17"><a href="#cb26-17" tabindex="-1"></a>  <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">4</span>, <span class="dv">4</span>)</span>
<span id="cb26-18"><a href="#cb26-18" tabindex="-1"></a>)</span>
<span id="cb26-19"><a href="#cb26-19" tabindex="-1"></a><span class="fu">plot_sparse_LDA</span>(</span>
<span id="cb26-20"><a href="#cb26-20" tabindex="-1"></a>  <span class="fu">as.vector</span>(<span class="fu">coef</span>(lda_loadings, <span class="at">s =</span> <span class="fl">0.002</span>))</span>
<span id="cb26-21"><a href="#cb26-21" tabindex="-1"></a>)</span>
<span id="cb26-22"><a href="#cb26-22" tabindex="-1"></a><span class="fu">plot_sparse_LDA</span>(</span>
<span id="cb26-23"><a href="#cb26-23" tabindex="-1"></a>  <span class="fu">as.vector</span>(<span class="fu">coef</span>(lda_loadings, <span class="at">s =</span> <span class="fl">0.02</span>))</span>
<span id="cb26-24"><a href="#cb26-24" tabindex="-1"></a>)</span>
<span id="cb26-25"><a href="#cb26-25" tabindex="-1"></a><span class="fu">plot_sparse_LDA</span>(</span>
<span id="cb26-26"><a href="#cb26-26" tabindex="-1"></a>  <span class="fu">as.vector</span>(<span class="fu">coef</span>(lda_loadings, <span class="at">s =</span> <span class="fl">0.2</span>))</span>
<span id="cb26-27"><a href="#cb26-27" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="Lab4-Sparse-PCA-LDA_files/figure-html/sparse-LDA-plots-1.png" width="100%" style="display: block; margin: auto;" /></p>
<p>Alternatively, using <code>ggplot</code>:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a><span class="co"># Helper function for scatterplot between two sparse PCs</span></span>
<span id="cb27-2"><a href="#cb27-2" tabindex="-1"></a>plot_sparse_LDA <span class="ot">&lt;-</span> <span class="cf">function</span>(loadings) {</span>
<span id="cb27-3"><a href="#cb27-3" tabindex="-1"></a>  n_nonzero <span class="ot">&lt;-</span> <span class="fu">sum</span>(loadings[<span class="sc">-</span><span class="dv">1</span>] <span class="sc">!=</span> <span class="dv">0</span>)</span>
<span id="cb27-4"><a href="#cb27-4" tabindex="-1"></a>  SLDA <span class="ot">&lt;-</span> X <span class="sc">%*%</span> loadings[<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb27-5"><a href="#cb27-5" tabindex="-1"></a></span>
<span id="cb27-6"><a href="#cb27-6" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">data.frame</span>(SLDA, Y), <span class="fu">aes</span>(<span class="at">x =</span> Y, <span class="at">y =</span> SLDA, <span class="at">fill =</span> <span class="fu">as.factor</span>(Y))) <span class="sc">+</span></span>
<span id="cb27-7"><a href="#cb27-7" tabindex="-1"></a>    <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb27-8"><a href="#cb27-8" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> cols) <span class="sc">+</span></span>
<span id="cb27-9"><a href="#cb27-9" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Y&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Z&quot;</span>,</span>
<span id="cb27-10"><a href="#cb27-10" tabindex="-1"></a>      <span class="at">title =</span> <span class="fu">sprintf</span>(<span class="st">&quot;Subset of %d genes&quot;</span>, n_nonzero)</span>
<span id="cb27-11"><a href="#cb27-11" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb27-12"><a href="#cb27-12" tabindex="-1"></a>    <span class="fu">ylim</span>(<span class="sc">-</span><span class="dv">4</span>, <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb27-13"><a href="#cb27-13" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb27-14"><a href="#cb27-14" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>, <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))  </span>
<span id="cb27-15"><a href="#cb27-15" tabindex="-1"></a>}</span>
<span id="cb27-16"><a href="#cb27-16" tabindex="-1"></a></span>
<span id="cb27-17"><a href="#cb27-17" tabindex="-1"></a>plot1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">data.frame</span>(Z1, Y), <span class="fu">aes</span>(<span class="at">x =</span> Y, <span class="at">y =</span> Z1, <span class="at">fill =</span> <span class="fu">as.factor</span>(Y))) <span class="sc">+</span></span>
<span id="cb27-18"><a href="#cb27-18" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb27-19"><a href="#cb27-19" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> cols) <span class="sc">+</span></span>
<span id="cb27-20"><a href="#cb27-20" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Y&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Z&quot;</span>,</span>
<span id="cb27-21"><a href="#cb27-21" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Entire set of 2000 genes&quot;</span></span>
<span id="cb27-22"><a href="#cb27-22" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb27-23"><a href="#cb27-23" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="sc">-</span><span class="dv">4</span>, <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb27-24"><a href="#cb27-24" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb27-25"><a href="#cb27-25" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>, <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span>
<span id="cb27-26"><a href="#cb27-26" tabindex="-1"></a>plot2 <span class="ot">&lt;-</span> <span class="fu">plot_sparse_LDA</span>(</span>
<span id="cb27-27"><a href="#cb27-27" tabindex="-1"></a>  <span class="fu">as.vector</span>(<span class="fu">coef</span>(lda_loadings, <span class="at">s =</span> <span class="fl">0.002</span>))</span>
<span id="cb27-28"><a href="#cb27-28" tabindex="-1"></a>)</span>
<span id="cb27-29"><a href="#cb27-29" tabindex="-1"></a>plot3 <span class="ot">&lt;-</span> <span class="fu">plot_sparse_LDA</span>(</span>
<span id="cb27-30"><a href="#cb27-30" tabindex="-1"></a>  <span class="fu">as.vector</span>(<span class="fu">coef</span>(lda_loadings, <span class="at">s =</span> <span class="fl">0.02</span>))</span>
<span id="cb27-31"><a href="#cb27-31" tabindex="-1"></a>)</span>
<span id="cb27-32"><a href="#cb27-32" tabindex="-1"></a>plot4 <span class="ot">&lt;-</span> <span class="fu">plot_sparse_LDA</span>(</span>
<span id="cb27-33"><a href="#cb27-33" tabindex="-1"></a>  <span class="fu">as.vector</span>(<span class="fu">coef</span>(lda_loadings, <span class="at">s =</span> <span class="fl">0.2</span>))</span>
<span id="cb27-34"><a href="#cb27-34" tabindex="-1"></a>)</span>
<span id="cb27-35"><a href="#cb27-35" tabindex="-1"></a></span>
<span id="cb27-36"><a href="#cb27-36" tabindex="-1"></a><span class="fu">ggarrange</span>(plot1, plot2, plot3, plot4)</span></code></pre></div>
<p><img src="Lab4-Sparse-PCA-LDA_files/figure-html/sparse-LDA-ggplots-1.png" width="100%" style="display: block; margin: auto;" /></p>
<p><strong>Conclusion:</strong> Sparse LDA performs almost identically to the original LDA in separating normal and tumour tissues. Even with only the 18 most important genes, the sparse LDA is mostly able to discriminate the two classes well.
Therefore, the separation between normal and tumour tissues is mainly driven by only a small proportion of genes.</p>
</details>
</div>
</div>
<div id="bonus-evaluation-of-lda-as-a-predictive-classifier" class="section level2 unnumbered">
<h2>Bonus: Evaluation of LDA as a predictive classifier</h2>
<p>We use 10-fold cross-validation to evaluate the predictive accuracy of classifications from the original LDA on all 2000 genes and the SLDA on the three smaller subsets of genes.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">914751</span>)</span>
<span id="cb28-2"><a href="#cb28-2" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" tabindex="-1"></a><span class="co"># Helper function to compute accuracy given v, X, and Y</span></span>
<span id="cb28-4"><a href="#cb28-4" tabindex="-1"></a>lda_accuracy <span class="ot">&lt;-</span> <span class="cf">function</span>(v, X, Y) {</span>
<span id="cb28-5"><a href="#cb28-5" tabindex="-1"></a>  preds <span class="ot">&lt;-</span> (X <span class="sc">%*%</span> v) <span class="sc">&gt;</span> <span class="dv">0</span></span>
<span id="cb28-6"><a href="#cb28-6" tabindex="-1"></a>  obs <span class="ot">&lt;-</span> Y <span class="sc">==</span> <span class="st">&quot;t&quot;</span></span>
<span id="cb28-7"><a href="#cb28-7" tabindex="-1"></a>  <span class="fu">return</span>(<span class="dv">1</span> <span class="sc">-</span> <span class="fu">mean</span>(<span class="fu">abs</span>(preds <span class="sc">-</span> obs)))</span>
<span id="cb28-8"><a href="#cb28-8" tabindex="-1"></a>}</span>
<span id="cb28-9"><a href="#cb28-9" tabindex="-1"></a></span>
<span id="cb28-10"><a href="#cb28-10" tabindex="-1"></a>acc_full <span class="ot">&lt;-</span> acc_small <span class="ot">&lt;-</span> acc_smaller <span class="ot">&lt;-</span> acc_smallest <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb28-11"><a href="#cb28-11" tabindex="-1"></a></span>
<span id="cb28-12"><a href="#cb28-12" tabindex="-1"></a><span class="co"># Randomly split the data into k folds</span></span>
<span id="cb28-13"><a href="#cb28-13" tabindex="-1"></a>folds <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="at">length.out =</span> <span class="fu">length</span>(Y)))</span>
<span id="cb28-14"><a href="#cb28-14" tabindex="-1"></a></span>
<span id="cb28-15"><a href="#cb28-15" tabindex="-1"></a><span class="cf">for</span> (k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>) {</span>
<span id="cb28-16"><a href="#cb28-16" tabindex="-1"></a>  <span class="co"># Assign the train and validation set for this fold</span></span>
<span id="cb28-17"><a href="#cb28-17" tabindex="-1"></a>  val_idx <span class="ot">&lt;-</span> <span class="fu">which</span>(folds <span class="sc">==</span> k)</span>
<span id="cb28-18"><a href="#cb28-18" tabindex="-1"></a>  train_idx <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(<span class="fu">seq_len</span>(<span class="fu">length</span>(Y)), val_idx)</span>
<span id="cb28-19"><a href="#cb28-19" tabindex="-1"></a>  X_train <span class="ot">&lt;-</span> X[train_idx, , drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb28-20"><a href="#cb28-20" tabindex="-1"></a>  Y_train <span class="ot">&lt;-</span> Y[train_idx]</span>
<span id="cb28-21"><a href="#cb28-21" tabindex="-1"></a>  X_val <span class="ot">&lt;-</span> X[val_idx, , drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb28-22"><a href="#cb28-22" tabindex="-1"></a>  Y_val <span class="ot">&lt;-</span> Y[val_idx]</span>
<span id="cb28-23"><a href="#cb28-23" tabindex="-1"></a></span>
<span id="cb28-24"><a href="#cb28-24" tabindex="-1"></a>  <span class="co"># Fit the LDA</span></span>
<span id="cb28-25"><a href="#cb28-25" tabindex="-1"></a>  lda_fold <span class="ot">&lt;-</span> <span class="fu">lda</span>(<span class="at">x =</span> X_train, <span class="at">grouping =</span> Y_train)</span>
<span id="cb28-26"><a href="#cb28-26" tabindex="-1"></a>  <span class="co"># Fit the SLDA with three levels of sparsity</span></span>
<span id="cb28-27"><a href="#cb28-27" tabindex="-1"></a>  Z_fold <span class="ot">&lt;-</span> X_train <span class="sc">%*%</span> lda_fold<span class="sc">$</span>scaling</span>
<span id="cb28-28"><a href="#cb28-28" tabindex="-1"></a>  lasso_fold <span class="ot">&lt;-</span> <span class="fu">glmnet</span>(X_train, Z_fold, <span class="at">alpha =</span> <span class="dv">1</span>, <span class="at">lambda =</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.02</span>, <span class="fl">0.002</span>))</span>
<span id="cb28-29"><a href="#cb28-29" tabindex="-1"></a>  <span class="co"># Evaluate the accuracy of all four models on the validation set</span></span>
<span id="cb28-30"><a href="#cb28-30" tabindex="-1"></a>  acc_full <span class="ot">&lt;-</span> <span class="fu">c</span>(acc_full, <span class="fu">lda_accuracy</span>(lda_fold<span class="sc">$</span>scaling, X_val, Y_val))</span>
<span id="cb28-31"><a href="#cb28-31" tabindex="-1"></a>  acc_small <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb28-32"><a href="#cb28-32" tabindex="-1"></a>    acc_small,</span>
<span id="cb28-33"><a href="#cb28-33" tabindex="-1"></a>    <span class="fu">lda_accuracy</span>(<span class="fu">as.vector</span>(<span class="fu">coef</span>(lasso_fold, <span class="at">s =</span> <span class="fl">0.002</span>))[<span class="sc">-</span><span class="dv">1</span>], X_val, Y_val)</span>
<span id="cb28-34"><a href="#cb28-34" tabindex="-1"></a>  )</span>
<span id="cb28-35"><a href="#cb28-35" tabindex="-1"></a>  acc_smaller <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb28-36"><a href="#cb28-36" tabindex="-1"></a>    acc_smaller,</span>
<span id="cb28-37"><a href="#cb28-37" tabindex="-1"></a>    <span class="fu">lda_accuracy</span>(<span class="fu">as.vector</span>(<span class="fu">coef</span>(lasso_fold, <span class="at">s =</span> <span class="fl">0.02</span>))[<span class="sc">-</span><span class="dv">1</span>], X_val, Y_val)</span>
<span id="cb28-38"><a href="#cb28-38" tabindex="-1"></a>  )</span>
<span id="cb28-39"><a href="#cb28-39" tabindex="-1"></a>  acc_smallest <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb28-40"><a href="#cb28-40" tabindex="-1"></a>    acc_smallest,</span>
<span id="cb28-41"><a href="#cb28-41" tabindex="-1"></a>    <span class="fu">lda_accuracy</span>(<span class="fu">as.vector</span>(<span class="fu">coef</span>(lasso_fold, <span class="at">s =</span> <span class="fl">0.2</span>))[<span class="sc">-</span><span class="dv">1</span>], X_val, Y_val)</span>
<span id="cb28-42"><a href="#cb28-42" tabindex="-1"></a>  )</span>
<span id="cb28-43"><a href="#cb28-43" tabindex="-1"></a>}</span>
<span id="cb28-44"><a href="#cb28-44" tabindex="-1"></a><span class="co">#&gt; Warning in lda.default(x, grouping, ...): variables are collinear</span></span>
<span id="cb28-45"><a href="#cb28-45" tabindex="-1"></a><span class="co">#&gt; Warning in lda.default(x, grouping, ...): variables are collinear</span></span>
<span id="cb28-46"><a href="#cb28-46" tabindex="-1"></a><span class="co">#&gt; Warning in lda.default(x, grouping, ...): variables are collinear</span></span>
<span id="cb28-47"><a href="#cb28-47" tabindex="-1"></a><span class="co">#&gt; Warning in lda.default(x, grouping, ...): variables are collinear</span></span>
<span id="cb28-48"><a href="#cb28-48" tabindex="-1"></a><span class="co">#&gt; Warning in lda.default(x, grouping, ...): variables are collinear</span></span>
<span id="cb28-49"><a href="#cb28-49" tabindex="-1"></a><span class="co">#&gt; Warning in lda.default(x, grouping, ...): variables are collinear</span></span>
<span id="cb28-50"><a href="#cb28-50" tabindex="-1"></a><span class="co">#&gt; Warning in lda.default(x, grouping, ...): variables are collinear</span></span>
<span id="cb28-51"><a href="#cb28-51" tabindex="-1"></a><span class="co">#&gt; Warning in lda.default(x, grouping, ...): variables are collinear</span></span>
<span id="cb28-52"><a href="#cb28-52" tabindex="-1"></a><span class="co">#&gt; Warning in lda.default(x, grouping, ...): variables are collinear</span></span>
<span id="cb28-53"><a href="#cb28-53" tabindex="-1"></a><span class="co">#&gt; Warning in lda.default(x, grouping, ...): variables are collinear</span></span>
<span id="cb28-54"><a href="#cb28-54" tabindex="-1"></a></span>
<span id="cb28-55"><a href="#cb28-55" tabindex="-1"></a><span class="fu">data.frame</span>(</span>
<span id="cb28-56"><a href="#cb28-56" tabindex="-1"></a>  <span class="at">LDA =</span> <span class="fu">c</span>(<span class="st">&quot;original&quot;</span>, <span class="st">&quot;sparse&quot;</span>, <span class="st">&quot;sparser&quot;</span>, <span class="st">&quot;sparsest&quot;</span>),</span>
<span id="cb28-57"><a href="#cb28-57" tabindex="-1"></a>  <span class="at">accuracy =</span> <span class="fu">c</span>(</span>
<span id="cb28-58"><a href="#cb28-58" tabindex="-1"></a>    <span class="fu">mean</span>(acc_full), <span class="fu">mean</span>(acc_small), <span class="fu">mean</span>(acc_smaller), <span class="fu">mean</span>(acc_smallest)</span>
<span id="cb28-59"><a href="#cb28-59" tabindex="-1"></a>  )</span>
<span id="cb28-60"><a href="#cb28-60" tabindex="-1"></a>)</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["LDA"],"name":[1],"type":["chr"],"align":["left"]},{"label":["accuracy"],"name":[2],"type":["dbl"],"align":["right"]}],"data":[{"1":"original","2":"0.7619048"},{"1":"sparse","2":"0.8095238"},{"1":"sparser","2":"0.7785714"},{"1":"sparsest","2":"0.8428571"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<div id="additional-resources" class="section level1 unnumbered">
<h1>Additional resources</h1>
<ul>
<li>Section 4.3 (LDA) and 14.5.5 (SPCA) of <span class="citation">Hastie, Tibshirani, and Friedman (2009)</span></li>
<li>For a simple explanation of the concept and interpretation of LDA (and other statistical methods), have a look at <a href="https://www.youtube.com/watch?v=azXCzI57Yfc" class="uri">https://www.youtube.com/watch?v=azXCzI57Yfc</a></li>
</ul>
</div>
<div id="session-info" class="section level1 unnumbered">
<h1>Session info</h1>
<details>
<summary>
Session info
</summary>
<pre><code>#&gt; [1] &quot;2025-11-06 10:03:36 CET&quot;
#&gt; ‚îÄ Session info ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
#&gt;  setting  value
#&gt;  version  R version 4.5.2 (2025-10-31)
#&gt;  os       macOS Sequoia 15.6
#&gt;  system   aarch64, darwin20
#&gt;  ui       X11
#&gt;  language (EN)
#&gt;  collate  en_US.UTF-8
#&gt;  ctype    en_US.UTF-8
#&gt;  tz       Europe/Brussels
#&gt;  date     2025-11-06
#&gt;  pandoc   3.6.3 @ /Applications/RStudio.app/Contents/Resources/app/quarto/bin/tools/aarch64/ (via rmarkdown)
#&gt;  quarto   1.7.32 @ /Applications/RStudio.app/Contents/Resources/app/quarto/bin/quarto
#&gt; 
#&gt; ‚îÄ Packages ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
#&gt;  package      * version date (UTC) lib source
#&gt;  abind          1.4-8   2024-09-12 [1] CRAN (R 4.5.0)
#&gt;  backports      1.5.0   2024-05-23 [1] CRAN (R 4.5.0)
#&gt;  bookdown       0.45    2025-10-03 [1] CRAN (R 4.5.0)
#&gt;  broom          1.0.10  2025-09-13 [1] CRAN (R 4.5.0)
#&gt;  bslib          0.9.0   2025-01-30 [1] CRAN (R 4.5.0)
#&gt;  cachem         1.1.0   2024-05-16 [1] CRAN (R 4.5.0)
#&gt;  car            3.1-3   2024-09-27 [1] CRAN (R 4.5.0)
#&gt;  carData        3.0-5   2022-01-06 [1] CRAN (R 4.5.0)
#&gt;  cli            3.6.5   2025-04-23 [1] CRAN (R 4.5.0)
#&gt;  codetools      0.2-20  2024-03-31 [1] CRAN (R 4.5.2)
#&gt;  cowplot        1.2.0   2025-07-07 [1] CRAN (R 4.5.0)
#&gt;  digest         0.6.37  2024-08-19 [1] CRAN (R 4.5.0)
#&gt;  dplyr          1.1.4   2023-11-17 [1] CRAN (R 4.5.0)
#&gt;  evaluate       1.0.5   2025-08-27 [1] CRAN (R 4.5.0)
#&gt;  farver         2.1.2   2024-05-13 [1] CRAN (R 4.5.0)
#&gt;  fastmap        1.2.0   2024-05-15 [1] CRAN (R 4.5.0)
#&gt;  foreach        1.5.2   2022-02-02 [1] CRAN (R 4.5.0)
#&gt;  Formula        1.2-5   2023-02-24 [1] CRAN (R 4.5.0)
#&gt;  generics       0.1.4   2025-05-09 [1] CRAN (R 4.5.0)
#&gt;  ggplot2      * 4.0.0   2025-09-11 [1] CRAN (R 4.5.0)
#&gt;  ggpubr       * 0.6.2   2025-10-17 [1] CRAN (R 4.5.0)
#&gt;  ggsignif       0.6.4   2022-10-13 [1] CRAN (R 4.5.0)
#&gt;  glmnet       * 4.1-10  2025-07-17 [1] CRAN (R 4.5.0)
#&gt;  glue           1.8.0   2024-09-30 [1] CRAN (R 4.5.0)
#&gt;  gridExtra    * 2.3     2017-09-09 [1] CRAN (R 4.5.0)
#&gt;  gtable         0.3.6   2024-10-25 [1] CRAN (R 4.5.0)
#&gt;  HDDAData     * 1.0.1   2025-11-06 [1] Github (statOmics/HDDAData@b832c71)
#&gt;  htmltools      0.5.8.1 2024-04-04 [1] CRAN (R 4.5.0)
#&gt;  iterators      1.0.14  2022-02-05 [1] CRAN (R 4.5.0)
#&gt;  jquerylib      0.1.4   2021-04-26 [1] CRAN (R 4.5.0)
#&gt;  jsonlite       2.0.0   2025-03-27 [1] CRAN (R 4.5.0)
#&gt;  knitr          1.50    2025-03-16 [1] CRAN (R 4.5.0)
#&gt;  labeling       0.4.3   2023-08-29 [1] CRAN (R 4.5.0)
#&gt;  lattice        0.22-7  2025-04-02 [1] CRAN (R 4.5.2)
#&gt;  lifecycle      1.0.4   2023-11-07 [1] CRAN (R 4.5.0)
#&gt;  magrittr       2.0.4   2025-09-12 [1] CRAN (R 4.5.0)
#&gt;  MASS         * 7.3-65  2025-02-28 [1] CRAN (R 4.5.2)
#&gt;  Matrix       * 1.7-4   2025-08-28 [1] CRAN (R 4.5.2)
#&gt;  pillar         1.11.1  2025-09-17 [1] CRAN (R 4.5.0)
#&gt;  pkgconfig      2.0.3   2019-09-22 [1] CRAN (R 4.5.0)
#&gt;  purrr          1.2.0   2025-11-04 [1] CRAN (R 4.5.0)
#&gt;  R6             2.6.1   2025-02-15 [1] CRAN (R 4.5.0)
#&gt;  RColorBrewer   1.1-3   2022-04-03 [1] CRAN (R 4.5.0)
#&gt;  Rcpp           1.1.0   2025-07-02 [1] CRAN (R 4.5.0)
#&gt;  rlang          1.1.6   2025-04-11 [1] CRAN (R 4.5.0)
#&gt;  rmarkdown      2.30    2025-09-28 [1] CRAN (R 4.5.0)
#&gt;  rstatix        0.7.3   2025-10-18 [1] CRAN (R 4.5.0)
#&gt;  rstudioapi     0.17.1  2024-10-22 [1] CRAN (R 4.5.0)
#&gt;  S7             0.2.0   2024-11-07 [1] CRAN (R 4.5.0)
#&gt;  sass           0.4.10  2025-04-11 [1] CRAN (R 4.5.0)
#&gt;  scales         1.4.0   2025-04-24 [1] CRAN (R 4.5.0)
#&gt;  sessioninfo    1.2.3   2025-02-05 [1] CRAN (R 4.5.0)
#&gt;  shape          1.4.6.1 2024-02-23 [1] CRAN (R 4.5.0)
#&gt;  survival       3.8-3   2024-12-17 [1] CRAN (R 4.5.2)
#&gt;  tibble         3.3.0   2025-06-08 [1] CRAN (R 4.5.0)
#&gt;  tidyr          1.3.1   2024-01-24 [1] CRAN (R 4.5.0)
#&gt;  tidyselect     1.2.1   2024-03-11 [1] CRAN (R 4.5.0)
#&gt;  vctrs          0.6.5   2023-12-01 [1] CRAN (R 4.5.0)
#&gt;  withr          3.0.2   2024-10-28 [1] CRAN (R 4.5.0)
#&gt;  xfun           0.54    2025-10-30 [1] CRAN (R 4.5.0)
#&gt;  yaml           2.3.10  2024-07-26 [1] CRAN (R 4.5.0)
#&gt; 
#&gt;  [1] /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library
#&gt;  * ‚îÄ‚îÄ Packages attached to the search path.
#&gt; 
#&gt; ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ</code></pre>
</details>
</div>
<div id="references" class="section level1 unnumbered">
<h1>References</h1>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-alon1999broad" class="csl-entry">
Alon, Uri, Naama Barkai, Daniel A Notterman, Kurt Gish, Suzanne Ybarra, Daniel Mack, and Arnold J Levine. 1999. <span>‚ÄúBroad Patterns of Gene Expression Revealed by Clustering Analysis of Tumor and Normal Colon Tissues Probed by Oligonucleotide Arrays.‚Äù</span> <em>Proceedings of the National Academy of Sciences</em> 96 (12): 6745‚Äì50.
</div>
<div id="ref-esl-book" class="csl-entry">
Hastie, Trevor, Robert Tibshirani, and Jerome Friedman. 2009. <em>The Elements of Statistical Learning</em>. 2nd ed. Springer.
</div>
</div>
</div>

<div id="rmd-source-code">LS0tCnRpdGxlOiAiTGFiIDQ6IFNwYXJzZSBQQ0EgYW5kIExEQSIKc3VidGl0bGU6ICJIaWdoIERpbWVuc2lvbmFsIERhdGEgQW5hbHlzaXMgcHJhY3RpY2FscyIKYXV0aG9yOiAiQWRhcHRlZCBieSBNaWxhbiBNYWxmYWl0IGFuZCBMZW8gRnVocmhvcCIKZGF0ZTogIjE4IE5vdiAyMDIxIDxici8+IChMYXN0IHVwZGF0ZWQ6IDIwMjUtMTEtMDYpIgpyZWZlcmVuY2VzOgotIGlkOiBhbG9uMTk5OWJyb2FkCiAgdHlwZTogYXJ0aWNsZS1qb3VybmFsCiAgYXV0aG9yOgogIC0gZmFtaWx5OiBBbG9uCiAgICBnaXZlbjogVXJpCiAgLSBmYW1pbHk6IEJhcmthaQogICAgZ2l2ZW46IE5hYW1hCiAgLSBmYW1pbHk6IE5vdHRlcm1hbgogICAgZ2l2ZW46IERhbmllbCBBCiAgLSBmYW1pbHk6IEdpc2gKICAgIGdpdmVuOiBLdXJ0CiAgLSBmYW1pbHk6IFliYXJyYQogICAgZ2l2ZW46IFN1emFubmUKICAtIGZhbWlseTogTWFjawogICAgZ2l2ZW46IERhbmllbAogIC0gZmFtaWx5OiBMZXZpbmUKICAgIGdpdmVuOiBBcm5vbGQgSgogIGlzc3VlZDoKICAtIHllYXI6IDE5OTkKICB0aXRsZTogQnJvYWQgcGF0dGVybnMgb2YgZ2VuZSBleHByZXNzaW9uIHJldmVhbGVkIGJ5IGNsdXN0ZXJpbmcgYW5hbHlzaXMgb2YgdHVtb3IKICAgIGFuZCBub3JtYWwgY29sb24gdGlzc3VlcyBwcm9iZWQgYnkgb2xpZ29udWNsZW90aWRlIGFycmF5cwogIGNvbnRhaW5lci10aXRsZTogUHJvY2VlZGluZ3Mgb2YgdGhlIE5hdGlvbmFsIEFjYWRlbXkgb2YgU2NpZW5jZXMKICBwdWJsaXNoZXI6IE5hdGlvbmFsIEFjYWQgU2NpZW5jZXMKICBwYWdlOiA2NzQ1LTY3NTAKICB2b2x1bWU6ICc5NicKICBpc3N1ZTogJzEyJwotIGlkOiBlc2wtYm9vawogIHR5cGU6IGJvb2sKICBhdXRob3I6CiAgLSBmYW1pbHk6IEhhc3RpZQogICAgZ2l2ZW46IFRyZXZvcgogIC0gZmFtaWx5OiBUaWJzaGlyYW5pCiAgICBnaXZlbjogUm9iZXJ0CiAgLSBmYW1pbHk6IEZyaWVkbWFuCiAgICBnaXZlbjogSmVyb21lCiAgaXNzdWVkOgogIC0geWVhcjogMjAwOQogIHRpdGxlOiBUaGUgRWxlbWVudHMgb2YgU3RhdGlzdGljYWwgTGVhcm5pbmcKICBwdWJsaXNoZXI6IFNwcmluZ2VyCiAgZWRpdGlvbjogMm5kCi0tLQoKYGBge3Igc2V0dXAsIGluY2x1ZGU9RkFMU0UsIGNhY2hlPUZBTFNFfQprbml0cjo6b3B0c19jaHVuayRzZXQoCiAgY29sbGFwc2UgPSBUUlVFLAogIGNvbW1lbnQgPSAiIz4iLAogIGZpZy5hbGlnbiA9ICJjZW50ZXIiLAogIGZpZy53aWR0aCA9IDgsCiAgZmlnLmFzcCA9IDAuNjE4LAogIG91dC53aWR0aCA9ICIxMDAlIgopCmBgYAoKIyMjIFtDaGFuZ2UgbG9nXShodHRwczovL2dpdGh1Yi5jb20vc3RhdE9taWNzL0hEREEvY29tbWl0cy9tYXN0ZXIvTGFiNC1TcGFyc2UtUENBLUxEQS5SbWQpIHstfQoKKioqCgpgYGB7ciBsaWJyYXJpZXMsIHdhcm5pbmc9RkFMU0UsIG1lc3NhZ2U9RkFMU0V9CiMjIGluc3RhbGwgcGFja2FnZXMgd2l0aDoKIyBpbnN0YWxsLnBhY2thZ2VzKGMoImdsbW5ldCIsICJNQVNTIiwgImdncGxvdDIiLCAiZ3JpZEV4dHJhIiwgImdncHViciIpKQojIGlmICghcmVxdWlyZU5hbWVzcGFjZSgicmVtb3RlcyIsIHF1aWV0bHkgPSBUUlVFKSkgewojICAgICBpbnN0YWxsLnBhY2thZ2VzKCJyZW1vdGVzIikKIyB9CiMgcmVtb3Rlczo6aW5zdGFsbF9naXRodWIoInN0YXRPbWljcy9IRERBRGF0YSIpCgpsaWJyYXJ5KGdsbW5ldCkKbGlicmFyeShNQVNTKQpsaWJyYXJ5KEhEREFEYXRhKQpsaWJyYXJ5KGdncGxvdDIpCmxpYnJhcnkoZ3JpZEV4dHJhKQpsaWJyYXJ5KGdncHVicikKYGBgCgoKIyBJbnRyb2R1Y3Rpb24KCioqSW4gdGhpcyBsYWIgc2Vzc2lvbiB3ZSB3aWxsIGxvb2sgYXQgdGhlIGZvbGxvd2luZyB0b3BpY3MqKgoKICAtIE1ldGhvZHMgdG8gc2V0IHNvbWUgb2YgdGhlIGxvYWRpbmdzIGV4YWN0bHkgdG8gemVybyBpbiBhIFBDQQogIC0gVXNlIGBnbG1uZXQoKWAgdG8gYWRkIHBlbmFsdGllcyBvbiBwcmluY2lwYWwgY29tcG9uZW50IGxvYWRpbmdzCiAgLSBVc2UgTERBIHRvIHVuZGVyc3RhbmQgZGlmZmVyZW5jZXMgYmV0d2VlbiBncm91cHMgaW4gYSBoaWdoIGRpbWVuc2lvbmFsIHNwYWNlCgojIyBUaGUgZGF0YXNldCB7LX0KCkluIHRoaXMgcHJhY3RpY2FsIHNlc3Npb24sIHdlIHVzZSB0aGUgZGF0YXNldCBieSBAYWxvbjE5OTlicm9hZCBvbiBnZW5lCmV4cHJlc3Npb24gbGV2ZWxzIGluIDQwIHR1bW91ciBhbmQgMjIgbm9ybWFsIGNvbG9uIHRpc3N1ZSBzYW1wbGVzLiAgVGhleSBjaGVja2VkCmEgdG90YWwgb2YgNjUwMCBodW1hbiBnZW5lcyB1c2luZyB0aGUgQWZmeW1ldHJpeCBvbGlnb251Y2xlb3RpZGUgYXJyYXkuCgpZb3UgY2FuIGxvYWQgdGhlIGRhdGEgaW4gYXMgZm9sbG93czoKCmBgYHtyIGxvYWQtZGF0YX0KZGF0YSgiQWxvbjE5OTkiKQpzdHIoQWxvbjE5OTlbLCAxOjEwXSkKZGltKEFsb24xOTk5KQp0YWJsZShBbG9uMTk5OSRZKQpgYGAKClRoZSBkYXRhc2V0IGNvbnRhaW5zIG9uZSB2YXJpYWJsZSBuYW1lZCBgWWAgd2l0aCB0aGUgdmFsdWVzIGB0YCBhbmQgYG5gLiAgVGhpcwp2YXJpYWJsZSBpbmRpY2F0ZXMgd2hldGhlciB0aGUgc2FtcGxlIGNhbWUgZnJvbSB0dW1vdXJvdXMgKGB0YCkgb3Igbm9ybWFsIChgbmApCnRpc3N1ZS4gIEZvciBtb3JlIGluZm9ybWF0aW9uIG9uIHRoaXMgZGF0YXNldCwgc2VlIGA/QWxvbjE5OTlgLgoKVGhlIGdvYWwgb2YgdGhpcyBwcmFjdGljYWwgaXMgdG8gZmluZCB0aGUgYmVzdCBzdWJzZXQgLyBjb21iaW5hdGlvbiBvZiBnZW5lcyB0byBkZXRlY3QgdHVtb3Vyb3VzIHRpc3N1ZS4KQXMgaW4gQGFsb24xOTk5YnJvYWQsIHdlIHVzZSB0aGUgMjAwMCBnZW5lcyB3aXRoIHRoZSBoaWdoZXN0IG1pbmltYWwgaW50ZW5zaXR5CmFjcm9zcyB0aGUgc2FtcGxlcy4KCiMgU3BhcnNlIFBDQQoKQmVnaW4gYnkgY29uc3RydWN0aW5nIHRoZSBkYXRhIG1hdHJpeCBgWGAsIHdoaWNoIGNvbnRhaW5zIHRoZSBjZW50ZXJlZCBhbmQgc2NhbGVkIHByZWRpY3RvcnMsCmFuZCB0aGUgcmVzcG9uc2UgdmFyaWFibGUgYFlgIGFzIGEgYmluYXJ5IGZhY3Rvci4KCmBgYHtyfQpYIDwtIHNjYWxlKEFsb24xOTk5WywgLTFdLCBjZW50ZXIgPSBUUlVFLCBzY2FsZSA9IFRSVUUpClkgPC0gYXMuZmFjdG9yKEFsb24xOTk5WywgMV0pCmBgYAoKVXNlIHRoZXNlIG9iamVjdHMgdG8gc29sdmUgdGhlIGZvbGxvd2luZyBleGVyY2lzZXMuCgojIyBUYXNrcyB7LX0KCiMjIyMjIDEuIFBlcmZvcm0gYSBTVkQgb24gYFhgIGFuZCBzdG9yZSB0aGUgc2NvcmVzIG9mIHRoZSBQQ3MuIHstfQoKPGRldGFpbHM+PHN1bW1hcnk+U29sdXRpb248L3N1bW1hcnk+CgpVc2luZyBgc3ZkYDoKCmBgYHtyfQpzdmRfWCA8LSBzdmQoWCkKWiA8LSBzdmRfWCR1ICUqJSBkaWFnKHN2ZF9YJGQpICMgQ2FsY3VsYXRlIHRoZSBzY29yZXMKViA8LSBzdmRfWCR2ICAgICAgICAgICAgICAgICAjIENhbGN1bGF0ZSB0aGUgbG9hZGluZ3MKYGBgCgpVc2luZyBgcHJjb21wYDoKCmBgYHtyfQojIFggaXMgYWxyZWFkeSBjZW50ZXJlZCBhbmQgc2NhbGVkIHNvIG5vIG5lZWQgdG8gZG8gYWdhaW4KcGNhX3ggPC0gcHJjb21wKFgsIGNlbnRlciA9IEZBTFNFLCBzY2FsZS4gPSBGQUxTRSkKIyBUaGUgc2NvcmVzIGFyZSBnaXZlbiBieSBgcGNhX3gkeGAsIHRoZSBsb2FkaW5ncyBhcmUgYHBjYV94JHJvdGF0aW9uYApgYGAKCjwvZGV0YWlscz4KCgojIyMjIyAyLiBQcm9kdWNlIGEgc2NyZWUgcGxvdCBhbmQgY29uZmlybSB0aGF0IHRoZSBmaXJzdCBhbmQgc2Vjb25kIFBDcyBjYW4gYXBwcm94aW1hdGUgdGhlIGRhdGEgdG8gc29tZSBleHRlbnQuIHstfQoKUmVjYWxsIGZyb20gW0xhYiAyXShodHRwczovL3N0YXRvbWljcy5naXRodWIuaW8vSEREQS9MYWIyLVBDQS5odG1sI1Rhc2tzKSB0aGF0IGEgc2NyZWUgcGxvdCBkaXNwbGF5cyB0aGUgcHJvcG9ydGlvbiBvZiB2YXJpYW5jZSBleHBsYWluZWQgYnkgZWFjaCBQQy4KCjxkZXRhaWxzPjxzdW1tYXJ5PlNvbHV0aW9uPC9zdW1tYXJ5PgoKQ2FsY3VsYXRlIHRoZSBwcm9wb3J0aW9uIG9mIHZhcmlhbmNlIGV4cGxhaW5lZCBieSBlYWNoIFBDLgoKYGBge3IgcGNhLXZhci1wcm9wfQp2YXJfZXhwbGFpbmVkIDwtIHBjYV94JHNkZXZeMiAvIHN1bShwY2FfeCRzZGV2XjIpCiMgYWx0ZXJuYXRpdmU6IHN2ZF9YJGReMiAvIHN1bShzdmRfWCRkXjIpCgojIENyZWF0ZSBkYXRhZnJhbWUgZm9yIHBsb3R0aW5nCnByb3BfdmFyIDwtIGRhdGEuZnJhbWUoUEMgPSAxOm5jb2wocGNhX3gkeCksIFZhciA9IHZhcl9leHBsYWluZWQpCiMgYWx0ZXJuYXRpdmU6IFBDID0gbmNvbChaKQpgYGAKClZpc3VhbGl6ZSB3aXRoIGEgc2NyZWUgcGxvdCB1c2luZyBgZ2dwbG90MmA6CgpgYGB7ciBwY2Etc2NyZWUtZ2dwbG90fQpnZ3Bsb3QocHJvcF92YXIsIGFlcyhQQywgVmFyKSkgKwogIGdlb21fcG9pbnQoKSArCiAgZ2VvbV9saW5lKCkgKwogIGdlb21fdmxpbmUoeGludGVyY2VwdCA9IDIuNSwgY29sID0gImZpcmVicmljayIpICsKICBzY2FsZV94X2NvbnRpbnVvdXMoYnJlYWtzID0gc2VxKDAsIDYwLCBieSA9IDUpKSArCiAgbGFicygKICAgIHkgPSAiUHJvcG9ydGlvbiBvZiB2YXJpYW5jZSIsCiAgICB0aXRsZSA9ICJQcm9wb3J0aW9uIG9mIHZhcmlhbmNlIGV4cGxhaW5lZCBieSBlYWNoIFBDIgogICkgKwogIHRoZW1lX21pbmltYWwoKQpgYGAKCkFsdGVybmF0aXZlbHksIHVzaW5nIGJhc2UgYFJgIHBsb3R0aW5nOgoKYGBge3IgcGNhLXNjcmVlLXBsb3R9CnBsb3QocHJvcF92YXIkUEMsIHByb3BfdmFyJFZhciwKICB0eXBlID0gImIiLCB5bGFiID0gIlByb3BvcnRpb24gb2YgdmFyaWFuY2UiLCB4bGFiID0gIlBDIiwKKQp0aXRsZSgiUHJvcG9ydGlvbiBvZiB2YXJpYW5jZSBleHBsYWluZWQgYnkgZWFjaCBQQyIpCmFibGluZSh2ID0gMi41LCBjb2wgPSAiZmlyZWJyaWNrIikKYGBgCgpBYm91dCA1NSUgb2YgdGhlIHZhcmlhbmNlIGluIHRoZSBkYXRhIGFyZSBleHBsYWluZWQgYnkgdGhlIGZpcnN0IGFuZCBzZWNvbmQgUENzLgoKYGBge3IgcGNhLWN1bXVsYXRpdmUtcHJvcC12YXJ9CmN1bXN1bShwcm9wX3ZhciRWYXIpWzE6MTBdCmBgYAoKPC9kZXRhaWxzPgoKCiMjIyMjIDMuIFBsb3QgdGhlIGZpcnN0IHR3byBQQ3MgYW5kIHVzZSBkaWZmZXJlbnQgY29sb3VycyBmb3IgdHVtb3IgLyBub3JtYWwgdGlzc3VlLiB7LX0KCkR1ZSB0byB0aGUgbGFyZ2UgbnVtYmVyIG9mIGZlYXR1cmVzLCB0aGUgYmlwbG90IHdvdWxkIGJlIGRpZmZpY3VsdCB0byBpbnRlcnByZXQuIEEgc2ltcGxlIHNjYXR0ZXJwbG90LCBzZXBhcmF0ZWQgYnkgdHVtb3IgLyBub3JtYWwgdGlzc3VlLCBpcyBtb3JlIGluZm9ybWF0aXZlIGluIHRoaXMgc2V0dGluZy4KCjxkZXRhaWxzPjxzdW1tYXJ5PlNvbHV0aW9uPC9zdW1tYXJ5PgoKYGBge3IgcGNhLXRpc3N1ZS1nZ3Bsb3R9CnNjb3Jlc18xXzIgPC0gZGF0YS5mcmFtZShQQzEgPSBwY2FfeCR4WywgMV0sIFBDMiA9IHBjYV94JHhbLCAyXSwgVGlzc3VlID0gWSkKIyBBbHRlcm5hdGl2ZTogcmV0cmlldmUgc2NvcmVzIGZyb20gWlssIDFdLCBaWywgMl0KCmdncGxvdChzY29yZXNfMV8yLCBhZXMoUEMxLCBQQzIpKSArCiAgZ2VvbV9wb2ludChhZXMoY29sID0gVGlzc3VlKSwgc2l6ZSA9IDIpICsKICBzY2FsZV9jb2xvcl9tYW51YWwodmFsdWVzID0gYygiZGVlcHNreWJsdWUyIiwgImNvcmFsMSIpKSArCiAgdGhlbWVfbWluaW1hbCgpICsKICB0aGVtZShhc3BlY3QucmF0aW8gPSAwLjgsIGxlZ2VuZC5wb3NpdGlvbiA9ICJ0b3AiKQpgYGAKCkFsdGVybmF0aXZlbHksIHVzaW5nIGJhc2UgYFJgIHBsb3R0aW5nOgoKYGBge3IgcGNhLXRpc3N1ZS1wbG90fQpjb2xzIDwtIGMoIm4iID0gImRlZXBza3libHVlMiIsICJ0IiA9ICJjb3JhbDEiKQpwbG90KHNjb3Jlc18xXzIkUEMxLCBzY29yZXNfMV8yJFBDMiwKICBjb2wgPSBjb2xzW1ldLAogIHhsYWIgPSAiUEMxIiwgeWxhYiA9ICJQQzIiLCBwY2ggPSAxOQopCmxlZ2VuZCgidG9wbGVmdCIsIGMoIk5vcm1hbCIsICJUdW1vciIpLAogIGNvbCA9IGNvbHMsCiAgcGNoID0gMTksIHRpdGxlID0gIlRpc3N1ZSIKKQpgYGAKCl9fSW50ZXJwcmV0YXRpb246X18gdXNpbmcgb25seSB0aGUgZmlyc3QgMiBQQ3MgZG9lcyBub3Qgc2VlbSB0byBzZXBhcmF0ZSB0aGUgdHVtb3IgYW5kIG5vcm1hbCBjYXNlcyBjbGVhcmx5LgoKPC9kZXRhaWxzPgoKCiMjIyMjIDQuIFBsb3QgaGlzdG9ncmFtcyBvZiB0aGUgbG9hZGluZ3Mgb2YgdGhlIGZpcnN0IGFuZCBzZWNvbmQgUENzLiBJbnRlcnByZXQuIHstfQoKPGRldGFpbHM+PHN1bW1hcnk+U29sdXRpb248L3N1bW1hcnk+CgpgYGB7ciBwY2EtbG9hZGluZy1nZ3Bsb3R9CmxvYWRpbmdzXzFfMiA8LSBkYXRhLmZyYW1lKAogIGxvYWRpbmdzXzEgPSBwY2FfeCRyb3RhdGlvblssIDFdLCBsb2FkaW5nc18yID0gcGNhX3gkcm90YXRpb25bLCAyXQopCiMgYWx0ZXJuYXRpdmU6IGxvYWRpbmdzXzEgPSBWWywgMV0sIGxvYWRpbmdzXzIgPSBWWywgMl0KCiMgRmlyc3QgcGxvdCAoUEMxKQpwMSA8LSBnZ3Bsb3QobG9hZGluZ3NfMV8yLCBhZXMoeCA9IGxvYWRpbmdzXzEpKSArCiAgZ2VvbV9oaXN0b2dyYW0oYmlucyA9IDUwLCBmaWxsID0gImdyZXk4MCIsIGNvbG9yID0gImJsYWNrIikgKwogIGdlb21fdmxpbmUoCiAgICB4aW50ZXJjZXB0ID0gcXVhbnRpbGUobG9hZGluZ3NfMV8yJGxvYWRpbmdzXzEsIDAuOTUpLAogICAgY29sb3IgPSAiZmlyZWJyaWNrIiwKICAgIGxpbmV3aWR0aCA9IDEuMgogICkgKwogIGxhYnMoeCA9ICJQQyAxIGxvYWRpbmdzIiwgeSA9ICJDb3VudCIsIHRpdGxlID0gTlVMTCkgKwogIHRoZW1lX21pbmltYWwoYmFzZV9zaXplID0gMTQpCgojIFNlY29uZCBwbG90IChQQzIpCnAyIDwtIGdncGxvdChsb2FkaW5nc18xXzIsIGFlcyh4ID0gbG9hZGluZ3NfMikpICsKICBnZW9tX2hpc3RvZ3JhbShiaW5zID0gNTAsIGZpbGwgPSAiZ3JleTgwIiwgY29sb3IgPSAiYmxhY2siKSArCiAgZ2VvbV92bGluZSgKICAgIHhpbnRlcmNlcHQgPSBxdWFudGlsZShsb2FkaW5nc18xXzIkbG9hZGluZ3NfMiwgYygwLjA1LCAwLjk1KSksCiAgICBjb2xvciA9ICJmaXJlYnJpY2siLAogICAgbGluZXdpZHRoID0gMS4yCiAgKSArCiAgbGFicyh4ID0gIlBDIDIgbG9hZGluZ3MiLCB5ID0gIkNvdW50IiwgdGl0bGUgPSBOVUxMKSArCiAgdGhlbWVfbWluaW1hbChiYXNlX3NpemUgPSAxNCkKCiMgQXJyYW5nZSBwbG90cyB2ZXJ0aWNhbGx5CmdyaWQuYXJyYW5nZShwMSwgcDIsIG5jb2wgPSAxKQpgYGAKCkFsdGVybmF0aXZlbHksIHVzaW5nIGJhc2UgYFJgIHBsb3R0aW5nOgoKYGBge3IgcGNhLWxvYWRpbmdzLXBsb3R9CnBhcihtZnJvdyA9IGMoMiwgMSkpCgojIEZpcnN0IHBsb3QgKFBDMSkKaGlzdChsb2FkaW5nc18xXzIkbG9hZGluZ3NfMSwgYnJlYWtzID0gNTAsIHhsYWIgPSAiUEMgMSBsb2FkaW5ncyIsIG1haW4gPSAiIikKIyBBZGQgdmVydGljYWwgbGluZSBhdCA5NSUgcXVhbnRpbGUKYWJsaW5lKHYgPSBxdWFudGlsZShsb2FkaW5nc18xXzIkbG9hZGluZ3NfMSwgMC45NSksIGNvbCA9ICJmaXJlYnJpY2siLCBsd2QgPSAyKQoKIyBTZWNvbmQgcGxvdCAoUEMyKQpoaXN0KGxvYWRpbmdzXzFfMiRsb2FkaW5nc18yLCBicmVha3MgPSA1MCwgeGxhYiA9ICJQQyAyIGxvYWRpbmdzIiwgbWFpbiA9ICIiKQphYmxpbmUodiA9IGMoCiAgcXVhbnRpbGUobG9hZGluZ3NfMV8yJGxvYWRpbmdzXzIsIDAuMDUpLAogIHF1YW50aWxlKGxvYWRpbmdzXzFfMiRsb2FkaW5nc18yLCAwLjk1KQopLCBjb2wgPSAiZmlyZWJyaWNrIiwgbHdkID0gMikKYGBgCgpWZXJ0aWNhbCBsaW5lcyB3ZXJlIGFkZGVkIGF0IHRoZSA5NXRoIHBlcmNlbnRpbGUgZm9yIFBDMSBhbmQgdGhlIDV0aCBhbmQgOTV0aCBwZXJjZW50aWxlcyBmb3IgUEMyIHRvIHJlZmxlY3Qgd2hlcmUgdGhlIGxhcmdlc3QgKGluIGFic29sdXRlIHZhbHVlKSBsb2FkaW5ncyBhcmUgc2l0dWF0ZWQgKG5vIG5lZ2F0aXZlIGxvYWRpbmdzIGZvciBQQzEsIHNvIG9ubHkgc2hvd2luZyB0aGUgOTV0aCBwZXJjZW50aWxlKS4KCl9fSW50ZXJwcmV0YXRpb246X18gcmVtZW1iZXIgdGhhdCB0aGUgUEMgbG9hZGluZ3MgcmVmbGVjdCB0aGUgKmNvbnRyaWJ1dGlvbnMqIG9mIGVhY2ggZmVhdHVyZSAoaW4gdGhpcyBjYXNlOiBnZW5lKSB0byB0aGUgUEMuCkZyb20gdGhlc2UgaGlzdG9ncmFtcyBpdCBzaG91bGQgYmUgY2xlYXIgdGhhdCBvbmx5IGEgbWlub3IgZnJhY3Rpb24gb2YgdGhlIGdlbmVzIGFyZSByZWFsbHkgZHJpdmluZyB0aGVzZSBmaXJzdCAyIFBDcywgZXNwZWNpYWxseSBmb3IgUEMyICh3aGVyZSB0aGUgYnVsayBvZiBnZW5lcyBoYXMgbG9hZGluZ3MgY2xvc2UgdG8gMCkuCgo8L2RldGFpbHM+CgpXZSBrbm93IHRoYXQgdGhlIGZpcnN0IFBDICRcbWF0aGJme1pfMX0kIGlzIGdpdmVuIGJ5CiQkClxtYXRoYmZ7Wl8xfT1cbWF0aGJme1h9IFxtYXRoYmZ7Vl8xfSBcLCAsCiQkCgp3aGVyZSAkXG1hdGhiZntWXzF9JCBhcmUgdGhlIGxvYWRpbmdzIG9mIHRoZSBmaXJzdCBQQy4gQnkgc2V0dGluZyAkXGJvbGRzeW1ib2x7XGJldGF9ID0gXG1hdGhiZntWXzF9JCBhbmQgJFkgPSBaXzEkLCB3ZSBjYW4gZXhwcmVzcyB0aGlzIGFzIHRoZSByZWdyZXNzaW9uCgokJApcbWF0aGJme1l9PVxtYXRoYmZ7WH1cYm9sZHN5bWJvbHtcYmV0YX0gXCwgLgokJAoKUmVjYWxsIHRoYXQgdGhlIHJpZGdlIHJlZ3Jlc3Npb24gc29sdXRpb24gZm9yICRcYm9sZHN5bWJvbHtcYmV0YX0kIGlzIGdpdmVuIGJ5CgokJApcYm9sZHN5bWJvbHtcYmV0YX1fe1x0ZXh0e3JpZGdlfX0gPSAoXG1hdGhiZntYXlRYfStcbGFtYmRhXG1hdGhiZntJfSleey0xfVxtYXRoYmZ7WH1eVFxtYXRoYmYgWSBcLCAuCiQkCgojIyMjIyA1LiBSZXBsYWNlICRcbWF0aGJme1l9JCB3aXRoICRcbWF0aGJme1pfMX0kIGFuZCB2ZXJpZnkgbnVtZXJpY2FsbHkgaW4gYFJgIHRoYXQgIHstfQogICQkCiAgXG1hdGhiZiBWXzEgPQogICAgXGZyYWN7XGJvbGRzeW1ib2xcYmV0YV97XHRleHR7cmlkZ2V9fX17XHxcYm9sZHN5bWJvbFxiZXRhX3tcdGV4dHtyaWRnZX19XHxfMn0gXCwgLgogICQkCgpZb3UgbWF5IHVzZSBhbnkgJFxsYW1iZGEgPiAwJCBvZiB5b3VyIGNob2ljZS4gUmVtZW1iZXIgdGhhdCAkXHxcYm9sZHN5bWJvbFxiZXRhX3tcdGV4dHtyaWRnZX19XHxfMiA9IFxzcXJ0e1xib2xkc3ltYm9sXGJldGFfe1x0ZXh0e3JpZGdlfX1eVCBcYm9sZHN5bWJvbFxiZXRhX3tcdGV4dHtyaWRnZX19fSA9IFxzcXJ0e1xzdW1fe2o9MX1ecCBcYmV0YV9qXjJ9JC4KCjxkZXRhaWxzPjxzdW1tYXJ5PlNvbHV0aW9uPC9zdW1tYXJ5PgoKYGBge3IsIGNhY2hlPVRSVUV9CnAgPC0gZGltKFgpWzJdCnRYWF9sYW1iZGFfSSA8LSB0KFgpICUqJSBYICsgMiAqIGRpYWcocCkKIyBUaGlzIG1pZ2h0IHRha2UgYSB3aGlsZSB0byBjYWxjdWxhdGUKYmV0YV9yaWRnZSA8LSBzb2x2ZSh0WFhfbGFtYmRhX0kpICUqJSB0KFgpICUqJSBaWywgMV0KbWFnX2JldGFfcmlkZ2UgPC0gc3FydChzdW0oYmV0YV9yaWRnZV4yKSkKbWF4KGFicyhWWywgMV0gLSBiZXRhX3JpZGdlIC8gbWFnX2JldGFfcmlkZ2UpKQojIGFsdGVybmF0aXZlIGZvciBWWywgMV06IHBjYV94JHJvdGF0aW9uWywgMV0KYGBgCgpGb3IgYSB2aXN1YWwgY29tcGFyaXNvbiwgd2UgY2FuIGFsc28gcGxvdAokXGJvbGRzeW1ib2xcYmV0YV97XHRleHR7cmlkZ2V9fSAvIFx8XGJvbGRzeW1ib2xcYmV0YV97XHRleHR7cmlkZ2V9fVx8XzIkCmFnYWluc3QgdGhlIGxvYWRpbmdzICRcbWF0aGJmIFZfMSQuCgpgYGB7ciBiZXRhX3JpZGdlLXZzLVYxLXBsb3R9CnBhcihtZnJvdyA9IGMoMSwgMSkpCgpwbG90KFZbLCAxXSwgYmV0YV9yaWRnZSAvIG1hZ19iZXRhX3JpZGdlLAogIHhsYWIgPSBleHByZXNzaW9uKCJWIlsxXSksCiAgeWxhYiA9IGV4cHJlc3Npb24oYmV0YVsicmlkZ2UiXSAvIHBhc3RlKCJ8fCIsIGJldGEsICJ8fCIpWzJdKSwKICBwY2ggPSAxOQopCmBgYAoKPC9kZXRhaWxzPgoKWW91IGhhdmUgbm93IHNlZW4gdGhhdCB0aGUgbG9hZGluZ3Mgb2YgdGhlIFBDcyBjYW4gYmUgY29tcHV0ZWQgZnJvbSByaWRnZSByZWdyZXNzaW9uIGNvZWZmaWNpZW50cy4KCklmIHdlIGludHJvZHVjZSBhbiBhZGRpdGlvbmFsICRMXzEkIHBlbmFsdHkgb24gdGhlICRcYm9sZHN5bWJvbCBcYmV0YSQgY29lZmZpY2llbnRzLCB3ZSBtb3ZlIGZyb20gcmlkZ2UgcmVncmVzc2lvbiB0byBlbGFzdGljIG5ldCByZWdyZXNzaW9uLiBSZWNhbGwgdGhhdCBlbGFzdGljIG5ldCByZWdyZXNzaW9uIG1pbmltaXplcyB0aGUgY3JpdGVyaW9uCiQkClx8XG1hdGhiZiBZLVxtYXRoYmZ7WH1cYm9sZHN5bWJvbCBcYmV0YVx8XjJfMiArICBcYWxwaGEgXGxhbWJkYVx8XGJvbGRzeW1ib2wgXGJldGFcfF8xICsgKDEgLSBcYWxwaGEpIFxsYW1iZGFcfFxib2xkc3ltYm9sIFxiZXRhXHxeMl8yCiQkCmZvciAkXGFscGhhIFxpbiBbMCwxXSQuIFdoZW5ldmVyICRcYWxwaGEgPiAwJCwgYSBzdWZmaWNpZW50bHkgbGFyZ2UgJFxsYW1iZGEkIGZvcmNlcyBzb21lIG9mIHRoZSBjb2VmZmljaWVudHMgaW4gJFxib2xkc3ltYm9sXGJldGEkIHRvIGJlY29tZSB6ZXJvLgoKUmVncmVzc2luZyB0aGUgcHJpbmNpcGFsIGNvbXBvbmVudCAkWl8xJCBvbiAkWCQgdGhlcmVmb3JlIHNldHMgc29tZSBvZiB0aGUgbG9hZGluZ3MgJFZfMSQgdG8gemVyby4gVGhpcyBtZWFucyB0aGF0IGVsYXN0aWMgbmV0IGNhbiBiZSB1c2VkIHRvIGltcGxlbWVudCBzcGFyc2UgUENBLiAKCiMjIyMjIDYuIEZpdCBhbiBlbGFzdGljIG5ldCBtb2RlbCBmb3IgJFpfMSQuIFVzZSBgYWxwaGEgPSAwLjVgIGFuZCBgbGFtYmRhID0gYygxMSwgMS43NSwgMC4zKWAuIERldGVybWluZSB0aGUgbnVtYmVyIG9mIG5vbi16ZXJvIGxvYWRpbmdzIGZvciBlYWNoIGNob2ljZSBvZiBgbGFtYmRhYC4gUmVwZWF0IHRoZSBzYW1lIHN0ZXBzIGZvciAkWl8yJCwgYnV0IHVzZSBgbGFtYmRhID0gYyg1LCAxLjUsIDAuMTUpYC4gey19Cgo8ZGV0YWlscz48c3VtbWFyeT5Tb2x1dGlvbjwvc3VtbWFyeT4KCmBgYHtyIFBDLWdsbW5ldH0KIyBIZWxwZXIgZnVuY3Rpb24gdG8gZGV0ZXJtaW5lIG51bWJlciBvZiBub24temVybyBsb2FkaW5ncwpudW1fbG9hZGluZ3MgPC0gZnVuY3Rpb24oZml0KSB7CiAgbGFtYmRhcyA8LSBmaXQkbGFtYmRhCiAgbnVtX25vbnplcm8gPC0gTlVMTAogIGZvciAobGFtYmRhIGluIGxhbWJkYXMpIHsKICAgIG51bV9ub256ZXJvIDwtIGMoCiAgICAgIG51bV9ub256ZXJvLCBzdW0oYXMudmVjdG9yKGNvZWYoZml0LCBzID0gbGFtYmRhKSlbLTFdICE9IDApCiAgICApCiAgfQogIHJldHVybihkYXRhLmZyYW1lKGxhbWJkYXMsIG51bV9ub256ZXJvKSkKfQoKIyBFbGFzdGljIG5ldCBmb3IgWl8xCmZpdF9sb2FkaW5nczEgPC0gZ2xtbmV0KFgsIFpbLCAxXSwgYWxwaGEgPSAwLjUsIGxhbWJkYSA9IGMoMTEsIDEuNzUsIDAuMykpCm51bV9sb2FkaW5ncyhmaXRfbG9hZGluZ3MxKQoKIyBFbGFzdGljIG5ldCBmb3IgWl8yCmZpdF9sb2FkaW5nczIgPC0gZ2xtbmV0KFgsIFpbLCAyXSwgYWxwaGEgPSAwLjUsIGxhbWJkYSA9IGMoNSwgMS41LCAwLjE1KSkKbnVtX2xvYWRpbmdzKGZpdF9sb2FkaW5nczIpCmBgYAoKPC9kZXRhaWxzPgoKIyMjIyMgNy4gUGxvdCB0aGUgcmVzdWx0aW5nIHNwYXJzZSBmaXJzdCBhbmQgc2Vjb25kIFBDcyBhbmQgdXNlIGRpZmZlcmVudCBjb2xvcnMgZm9yIHR1bW9yIC8gbm9ybWFsIHRpc3N1ZS4gSG93IHdlbGwgZG8gdGhlc2UgbmV3IFBDcyBzZXBhcmF0ZSB0aGUgcmVzcG9uc2UgY2xhc3Nlcz8gey19CgpZb3UgbWF5IHJldXNlIHRoZSBjb2RlIGZyb20gdGFzayAzIHRvIHByb2R1Y2UgMyBuZXcgcGxvdHMgZm9yICQoXGxhbWJkYV97XHRleHR7UEMxfX0gPSAxMSwgXGxhbWJkYV97XHRleHR7UEMyfX0gPSA1KSQsICQoXGxhbWJkYV97XHRleHR7UEMxfX0gPSAxLjc1LCBcbGFtYmRhX3tcdGV4dHtQQzJ9fSA9IDEuNSkkIGFuZCAkKFxsYW1iZGFfe1x0ZXh0e1BDMX19ID0gMC4zLCBcbGFtYmRhX3tcdGV4dHtQQzJ9fSA9IDAuMTUpJC4gQ29tcGFyZSB0aGlzIHRvIHRoZSBwbG90IGZvciB0aGUgb3JpZ2luYWwgUENzIGZyb20gdGFzayAzIGFuZCBpbnRlcnByZXQuCgo8ZGV0YWlscz48c3VtbWFyeT5Tb2x1dGlvbjwvc3VtbWFyeT4KClVzaW5nIGJhc2UgYFJgIHBsb3R0aW5nOgoKYGBge3Igc3BhcnNlLVBDQS1wbG90cywgZmlnLndpZHRoID0gOX0KIyBIZWxwZXIgZnVuY3Rpb24gZm9yIHNjYXR0ZXJwbG90IGJldHdlZW4gdHdvIHNwYXJzZSBQQ3MKcGxvdF9zcGFyc2VfUENBIDwtIGZ1bmN0aW9uKGxvYWRpbmdzMSwgbG9hZGluZ3MyKSB7CiAgbm9uemVybzEgPC0gc3VtKGxvYWRpbmdzMVstMV0gIT0gMCkKICBub256ZXJvMiA8LSBzdW0obG9hZGluZ3MyWy0xXSAhPSAwKQoKICBTUEMxIDwtIFggJSolIGxvYWRpbmdzMVstMV0KICBTUEMyIDwtIFggJSolIGxvYWRpbmdzMlstMV0KCiAgcGxvdCgKICAgIFNQQzEsIFNQQzIsIGNvbCA9IGNvbHNbWV0sIHhsYWIgPSAiU1BDMSIsIHlsYWIgPSAiU1BDMiIsIHBjaCA9IDE2LAogICAgeWxpbSA9IGMoLTQwLCA0MCksIHhsaW0gPSBjKC02MCwgOTUpLAogICAgbWFpbiA9IHBhc3RlKG5vbnplcm8xLCAiZ2VuZXMgZm9yIFNQQzEsIiwgbm9uemVybzIsICJmb3IgU1BDMiIpCiAgKQogIGxlZ2VuZCgKICAgICJ0b3BsZWZ0IiwgbGVnZW5kID0gYygiTm9ybWFsIHRpc3N1ZSIsICJUdW1vciB0aXNzdWUiKSwKICAgIGJ0eSA9ICJuIiwgY29sID0gY29scywgcGNoID0gYygxNiwgMTYpLCBjZXggPSAxCiAgKQp9CgpwYXIobWZyb3cgPSBjKDIsIDIpKQpwbG90KFpbLCAxXSwgWlssIDJdLAogIGNvbCA9IGNvbHNbWV0sIHhsYWIgPSAiUEMxIiwgeWxhYiA9ICJQQzIiLCBwY2ggPSAxNiwKICB5bGltID0gYygtNDAsIDQwKSwgeGxpbSA9IGMoLTYwLCA5NSksCiAgbWFpbiA9ICJBbGwgMjAwMCBnZW5lcyBcbmZvciBQQzEgYW5kIFBDMiIKKQpsZWdlbmQoCiAgInRvcGxlZnQiLCBsZWdlbmQgPSBjKCJOb3JtYWwgdGlzc3VlIiwgIlR1bW9yIHRpc3N1ZSIpLAogIGJ0eSA9ICJuIiwgY29sID0gY29scywgcGNoID0gYygxNiwgMTYpLCBjZXggPSAxCikKcGxvdF9zcGFyc2VfUENBKAogIGFzLnZlY3Rvcihjb2VmKGZpdF9sb2FkaW5nczEsIHMgPSAwLjMpKSwKICBhcy52ZWN0b3IoY29lZihmaXRfbG9hZGluZ3MyLCBzID0gMC4xNSkpCikKcGxvdF9zcGFyc2VfUENBKAogIGFzLnZlY3Rvcihjb2VmKGZpdF9sb2FkaW5nczEsIHMgPSAxLjc1KSksCiAgYXMudmVjdG9yKGNvZWYoZml0X2xvYWRpbmdzMiwgcyA9IDEuNSkpCikKcGxvdF9zcGFyc2VfUENBKAogIGFzLnZlY3Rvcihjb2VmKGZpdF9sb2FkaW5nczEsIHMgPSAxMSkpLAogIGFzLnZlY3Rvcihjb2VmKGZpdF9sb2FkaW5nczIsIHMgPSA2KSkKKQpgYGAKCkFsdGVybmF0aXZlbHksIHVzaW5nIGBnZ3Bsb3RgOgoKYGBge3IgZ2dwbG90LXNwY30KIyBIZWxwZXIgZnVuY3Rpb24gZm9yIHNjYXR0ZXJwbG90IGJldHdlZW4gdHdvIHNwYXJzZSBQQ3MKcGxvdF9zcGFyc2VfUENBIDwtIGZ1bmN0aW9uKGxvYWRpbmdzMSwgbG9hZGluZ3MyKSB7CiAgbm9uemVybzEgPC0gc3VtKGxvYWRpbmdzMVstMV0gIT0gMCkKICBub256ZXJvMiA8LSBzdW0obG9hZGluZ3MyWy0xXSAhPSAwKQoKICBTUEMxIDwtIFggJSolIGxvYWRpbmdzMVstMV0KICBTUEMyIDwtIFggJSolIGxvYWRpbmdzMlstMV0KCiAgZ2dwbG90KGRhdGEuZnJhbWUoU1BDMSwgU1BDMiwgVGlzc3VlID0gWSksIGFlcyhTUEMxLCBTUEMyKSkgKwogICAgZ2VvbV9wb2ludChhZXMoY29sID0gVGlzc3VlKSwgc2l6ZSA9IDIpICsKICAgIHNjYWxlX2NvbG9yX21hbnVhbCh2YWx1ZXMgPSBjKCJkZWVwc2t5Ymx1ZTIiLCAiY29yYWwxIikpICsKICAgIGxhYnModGl0bGUgPSBwYXN0ZShub256ZXJvMSwgImdlbmVzIGZvciBTUEMxLCIsIG5vbnplcm8yLCAiZm9yIFNQQzIiKSkgKwogICAgeGxpbSgtNjAsIDk1KSArCiAgICB5bGltKC00MCwgNDApICsKICAgIHRoZW1lX21pbmltYWwoKSArCiAgICB0aGVtZShsZWdlbmQucG9zaXRpb24gPSAiYm90dG9tIiwgdGV4dCA9IGVsZW1lbnRfdGV4dChzaXplID0gOCkpCn0KCnBsb3QxIDwtIGdncGxvdChzY29yZXNfMV8yLCBhZXMoUEMxLCBQQzIpKSArCiAgZ2VvbV9wb2ludChhZXMoY29sID0gVGlzc3VlKSwgc2l6ZSA9IDIpICsKICBzY2FsZV9jb2xvcl9tYW51YWwodmFsdWVzID0gYygiZGVlcHNreWJsdWUyIiwgImNvcmFsMSIpKSArCiAgbGFicyh0aXRsZSA9ICJBbGwgMjAwMCBnZW5lcyBmb3IgUEMxIGFuZCBQQzIiKSArCiAgeGxpbSgtNjAsIDk1KSArCiAgeWxpbSgtNDAsIDQwKSArCiAgdGhlbWVfbWluaW1hbCgpICsKICB0aGVtZShsZWdlbmQucG9zaXRpb24gPSAiYm90dG9tIiwgdGV4dCA9IGVsZW1lbnRfdGV4dChzaXplID0gOCkpCnBsb3QyIDwtIHBsb3Rfc3BhcnNlX1BDQSgKICBhcy52ZWN0b3IoY29lZihmaXRfbG9hZGluZ3MxLCBzID0gMC4zKSksCiAgYXMudmVjdG9yKGNvZWYoZml0X2xvYWRpbmdzMiwgcyA9IDAuMTUpKQopCnBsb3QzIDwtIHBsb3Rfc3BhcnNlX1BDQSgKICBhcy52ZWN0b3IoY29lZihmaXRfbG9hZGluZ3MxLCBzID0gMS43NSkpLAogIGFzLnZlY3Rvcihjb2VmKGZpdF9sb2FkaW5nczIsIHMgPSAxLjUpKQopCnBsb3Q0IDwtIHBsb3Rfc3BhcnNlX1BDQSgKICBhcy52ZWN0b3IoY29lZihmaXRfbG9hZGluZ3MxLCBzID0gMTEpKSwKICBhcy52ZWN0b3IoY29lZihmaXRfbG9hZGluZ3MyLCBzID0gNikpCikKCmdnYXJyYW5nZShwbG90MSwgcGxvdDIsIHBsb3QzLCBwbG90NCkKYGBgCgpfX0NvbmNsdXNpb246X18gU3BhcnNlIFBDQSBoYXMgc3VjY2VlZGVkIGluIHNldHRpbmcgdGhlIHVuaW5mb3JtYXRpdmUgZ2VuZXMgLyBsb2FkaW5ncyB0byB6ZXJvLiAKSW4gc2VwYXJhdGluZyBub3JtYWwgYW5kIHR1bW91ciB0aXNzdWVzLCBTUENBIHBlcmZvcm1zIHZpdHVhbGx5IHRoZSBzYW1lIGFzIFBDQS4gQnkgaW5jcmVhc2luZyAkXGxhbWJkYSQsIG1vcmUgc3BhcnNpdHkgaXMgaW5kdWNlZCBpbiB0aGUgbG9hZGluZ3MsIHdoaWxlIHRoZSBvdmVyYWxsIHZpc3VhbCBpbXByZXNzaW9uIHJlbWFpbnMgY29tcGFyYWJsZS4gClRoZSBrZXkgcG9pbnQgaGVyZSBpcyB0aGF0IFNQQ0EgdXNlcyBvbmx5IGEgbWlub3IgcHJvcG9ydGlvbiBvZiB0aGUgb3JpZ2luYWwgZmVhdHVyZXMgdG8gYWNoaWV2ZSB0aGUgc2FtZSByZXN1bHRzLCBzdWdnZXN0aW5nIHRoYXQgdGhlIGxhcmdlc3QgdmFyaWFiaWxpdHkgb2YgdGhlIGRhdGEgaXMgb25seSBkcml2ZW4gYnkgYSBtaW5vcml0eSBvZiBmZWF0dXJlcy4KCjwvZGV0YWlscz4KCl9fUmVtYXJrOl9fIE9mdGVudGltZXMsICRcbGFtYmRhJCBpcyBjaG9zZW4gaW4gc3VjaCBhIHdheSB0aGF0IGEgcGFydGljdWxhciBudW1iZXIgb3IgcmFuZ2Ugb2Ygbm9uemVybyBsb2FkaW5ncyBpcyBvYnRhaW5lZC4gVGhpcyBpcyBob3cgd2UgcHJvY2VlZGVkIGFib3ZlLCB3aGVyZSB3ZSBjb25zaWRlcmVkIGEgc2VxdWVuY2Ugb2YgJFxsYW1iZGEkJ3MgcmVzdWx0aW5nIGluIGRpZmZlcmVudCBsZXZlbHMgb2Ygc3BhcnNpdHkuCkFsdGVybmF0aXZlbHksIGlmIHlvdSB3YW50IHRvIHNlbGVjdCAkXGxhbWJkYSQgaW4gYSBkYXRhLWRyaXZlbiBtYW5uZXIsIHlvdSAqY2Fubm90KiByZWx5IG9uIGNyb3NzLXZhbGlkYXRpb24gd2l0aCB0aGUgcHJlZGljdGl2ZSBNU0UgYXMgdXNlZCBpbiBbTGFiIDNdKGh0dHBzOi8vc3RhdG9taWNzLmdpdGh1Yi5pby9IRERBL0xhYjMtUGVuYWxpemVkLVJlZ3Jlc3Npb24uaHRtbCM5X0V4ZXJjaXNlOl9ldmFsdWF0ZV9hbmRfY29tcGFyZV9wcmVkaWN0aW9uX21vZGVscykuIFRoZSByZWFzb24gZm9yIHRoaXMgaXMgdGhhdCB0aGUgbWluaW1hbCBjcm9zcy12YWxpZGF0ZWQgTVNFIHdpbGwgYmUgYWNoaWV2ZWQgZm9yICRcbGFtYmRhID0gMCQgKG9yIHRoZSBzbWFsbGVzdCBwb3NpdGl2ZSB2YWx1ZSB0aGF0IGNhbiBiZSBldmFsdWF0ZWQgd2l0aG91dCBudW1lcmljYWwgcHJvYmxlbXMpLgpJbnN0ZWFkLCB5b3UgY2FuIHRha2UgYSBsb29rIGF0IHRoZSBwcm9wb3J0aW9uIG9mIHZhcmlhbmNlIHRoYXQgaXMgZXhwbGFpbmVkIGJ5IHRoZSBzcGFyc2UgUENzIHRvIHNlbGVjdCBhIHNlbnNpYmxlIG51bWJlciBvZiBub256ZXJvIGxvYWRpbmdzIG9yIGEgc2Vuc2libGUgJFxsYW1iZGEkLiAKCgojIExEQQoKSW4gdGhpcyBzZWN0aW9uLCB3ZSB3aWxsIHBlcmZvcm0gTERBIG9uIHRoZSBkYXRhIGJ5IEBhbG9uMTk5OWJyb2FkIHRvIGdldCBhIGNsZWFyIHVuZGVyc3RhbmRpbmcgb24gdGhlIGdlbmVzIHJlc3BvbnNpYmxlIGZvciBzZXBhcmF0aW5nIHRoZSB0dW1vciBhbmQgbm9ybWFsIHRpc3N1ZSBncm91cHMuCgpSZW1lbWJlciB0aGF0IHRoZSBMREEgcHJvYmxlbSBjYW4gYmUgc3RhdGVkIGFzCgokJApcbWF0aGJme3Z9CiAgPSBcdGV4dHtBcmdNYXh9X2EgXGZyYWN7XG1hdGhiZnthXlQgQiBhfX17XG1hdGhiZnthXlQgVyBhfX0KICAgIFx0ZXh0eyBzdWJqZWN0IHRvIH0KICAgIFxtYXRoYmZ7YV5UIFcgYX0gPSAxIFwsICwKJCQKCndoaWNoIGlzIGVxdWl2YWxlbnQgdG8gdGhlIGVpZ2VudmFsdWUgLyBlaWdlbnZlY3RvciBwcm9ibGVtCgokJApcbWF0aGJmIFdeey0xfSBcbWF0aGJmIEIgXG1hdGhiZiBhPVxsYW1iZGEgXG1hdGhiZiBhIFwsIC4KJCQKCkluIG91ciBjYXNlLCB3aGVyZSB3ZSBvbmx5IGhhdmUgdHdvIGdyb3Vwcywgb25seSBvbmUgc29sdXRpb24gZXhpc3RzLgpUaGlzIGlzIHRoZSBlaWdlbnZlY3RvciAkYSA9IFxtYXRoYmYgdiQgYW5kIGl0cyBlaWdlbnZhbHVlLgokXG1hdGhiZiB2JCBjYW4gY2FuIGJlIGludGVycHJldGVkIGluIHRlcm1zIG9mIHdoaWNoIHByZWRpY3RvcnMgYXJlIGltcG9ydGFudCB0byBkaXNjcmltaW5hdGUgYmV0d2VlbiB0aGUgdHdvIGNsYXNzZXMuCldlIGNhbiB0aGVuIHdyaXRlIHRoZSBzY29yZXMgYXMKCiQkClxtYXRoYmYgWj1cbWF0aGJmIFggXG1hdGhiZiB2IFwsIC4KJCQKCgojIyBUYXNrcyB7LX0KCiMjIyMjIDEuIFVzZSB0aGUgYGxkYSgpYCBmdW5jdGlvbiBmcm9tIHRoZSBgTUFTU2AgcGFja2FnZSB0byBmaXQgYW4gTERBIG9uIGBYYCB3aXRoIGdyb3VwaW5nIGBZYC4gey19CgpOb3RlIHRoYXQgdGhlIGBncm91cGluZ2AgaGFzIHRvIGJlIGEgZmFjdG9yIHZhcmlhYmxlLgoKPGRldGFpbHM+PHN1bW1hcnk+U29sdXRpb248L3N1bW1hcnk+CgpgYGB7ciBMREF9CmFsb25fbGRhIDwtIGxkYSh4ID0gWCwgZ3JvdXBpbmcgPSBZKQoKIyBhbHRlcm5hdGl2ZTogWSB+IFgKYGBgCgpOb3RlIHRoZSB3YXJuaW5nIHJlZ2FyZGluZyBjb2xsaW5lYXJpdHkuCgo8L2RldGFpbHM+CgojIyMjIyAyLiBFeHRyYWN0ICRcbWF0aGJmIHYkIGZyb20gdGhlIGBsZGFgIG9iamVjdC4gey19CgpIaW50OiBIYXZlIGEgbG9vayBhdCB0aGUgIlZhbHVlIiBzZWN0aW9uIG9mIGA/bGRhYC4KCjxkZXRhaWxzPjxzdW1tYXJ5PlNvbHV0aW9uPC9zdW1tYXJ5PgoKYGBge3IgTERBLWVpZ2VudmVjdG9yfQpWMSA8LSBhbG9uX2xkYSRzY2FsaW5nCmBgYAoKPC9kZXRhaWxzPgoKIyMjIyMgMy4gQ29tcHV0ZSAkXG1hdGhiZiBaJC4gey19Cgo8ZGV0YWlscz48c3VtbWFyeT5Tb2x1dGlvbjwvc3VtbWFyeT4KCmBgYHtyIExEQS1zY29yZXN9CloxIDwtIFggJSolIFYxCmBgYAoKPC9kZXRhaWxzPgoKIyMjIyMgNC4gUGxvdCB0aGUgc2NvcmVzICRcbWF0aGJmIFokIGFnYWluc3QgdGhlIHJlc3BvbnNlIHRvIHNlZSBob3cgd2VsbCB0aGUgTERBIHNlcGFyYXRlcyB0aGUgdHVtb3VyIGFuZCBub3JtYWwgdGlzc3VlcyBncm91cHMuIEludGVycHJldCB5b3VyIHBsb3Quey19CgpIaW50OiBBIGJveHBsb3Qgd291bGQgYmUgYW4gYXBwcm9wcmlhdGUgdmlzdWFsaXphdGlvbiwgYnV0IGZlZWwgZnJlZSB0byBiZSBjcmVhdGl2ZS4KCjxkZXRhaWxzPjxzdW1tYXJ5PlNvbHV0aW9uPC9zdW1tYXJ5PgoKVXNpbmcgYGdncGxvdGA6CgpgYGB7ciBMREEtZ2dib3hwbG90fQpnZ3Bsb3QoZGF0YS5mcmFtZShaMSwgWSksIGFlcyh4ID0gWSwgeSA9IFoxLCBmaWxsID0gYXMuZmFjdG9yKFkpKSkgKwogIGdlb21fYm94cGxvdCgpICsKICBzY2FsZV9maWxsX21hbnVhbCh2YWx1ZXMgPSBjb2xzKSArCiAgbGFicyh4ID0gIlkiLCB5ID0gIloiLAogICAgdGl0bGUgPSAiU2VwYXJhdGlvbiBvZiBub3JtYWwgYW5kIHR1bW91ciBzYW1wbGVzIGJ5IExEQSIKICApICsKICB0aGVtZV9taW5pbWFsKCkgKwogIHRoZW1lKGxlZ2VuZC5wb3NpdGlvbiA9ICJub25lIiwgcGxvdC50aXRsZSA9IGVsZW1lbnRfdGV4dChoanVzdCA9IDAuNSkpCmBgYAoKQWx0ZXJuYXRpdmVseSwgdXNpbmcgYmFzZSBgUmAgcGxvdHRpbmc6CgpgYGB7ciBMREEtYm94cGxvdH0KcGFyKG1mcm93ID0gYygxLCAxKSkKYm94cGxvdCgKICBaMSB+IFksIGNvbCA9IGNvbHMsIHlsYWIgPSAiWiIsCiAgbWFpbiA9ICJTZXBhcmF0aW9uIG9mIG5vcm1hbCBhbmQgdHVtb3VyIHNhbXBsZXMgYnkgTERBIgopCmBgYAoKX19JbnRlcnByZXRhdGlvbl9fOiBUaGUgTERBIGNhbiBzZXBhcmF0ZSB0aGUgdHVtb3VyIGFuZCBub3JtYWwgdGlzc3VlIHNhbXBsZXMgdmVyeSB3ZWxsLiBJbiBjb21wYXJpc29uLCB0aGUgZmlyc3QgYW5kIHNlY29uZCBjb21wb25lbnRzIG9mIHRoZSAoc3BhcnNlKSBQQ0EgKGFuIHVuc3VwZXJ2aXNlZCBtZXRob2QpIGluIHRoZSBmaXJzdCBwYXJ0IG9mIHRoaXMgTGFiIGRpZCBub3QgZGlzY3JpbWluYXRlIHRoZSB0d28gZ3JvdXBzIG5lYXJseSBhcyB3ZWxsLgoKPC9kZXRhaWxzPgoKV2UgY2FuIHZpZXcKJCQKXG1hdGhiZiBaID0gXG1hdGhiZiBYIFxtYXRoYmYgdgokJAphcyBhIHJlZ3Jlc3Npb24gb2YgJFxtYXRoYmYgWiQgb24gJFxtYXRoYmYgWCQgd2l0aCBjb2VmZmljaWVudCB2ZWN0b3IgJFxtYXRoYmYgdiQuIFRoZSBlbnRyaWVzIG9mICRcbWF0aGJmIHYkIGFyZSBub24temVybyBmb3IgYWxsIGdlbmVzLgpUbyBpbXBsZW1lbnQgYSBzcGFyc2UgTERBLCB3aGVyZSBzb21lIG9mIHRoZSBlbnRyaWVzIG9mICRcbWF0aGJmIHYkIGFyZSBzZXQgdG8gemVybywgd2UgY2FuIGludHJvZHVjZSBhbiAkTF8xJCBwZW5hbHR5IG9uICRcbWF0aGJmIHYkIGFuZCBmaXQgYSBMYXNzbyByZWdyZXNzaW9uLgpUaGUgcmVzdWx0aW5nICRcbWF0aGJmIHYkIHdpbGwgb25seSBiZSBkZXRlcm1pbmVkIGJ5IGEgZmV3IGludGVyZXN0aW5nIGdlbmVzIGluc3RlYWQgb2YgYWxsIDIwMDAuCgojIyMjIyA1LiBGaXQgYSBMYXNzbyBtb2RlbCBmb3IgJFxtYXRoYmYgWiQgd2l0aCBgbGFtYmRhID0gYygwLjEsIDAuMDEsIDAuMDAxKWAuIERldGVybWluZSB0aGUgbnVtYmVyIG9mIG5vbi16ZXJvIGxvYWRpbmdzIGZvciBlYWNoIGNob2ljZSBvZiBgbGFtYmRhYC4gey19Cgo8ZGV0YWlscz48c3VtbWFyeT5Tb2x1dGlvbjwvc3VtbWFyeT4KCmBgYHtyIHNwYXJzZS1MREF9CmxkYV9sb2FkaW5ncyA8LSBnbG1uZXQoWCwgWjEsIGFscGhhID0gMSwgbGFtYmRhID0gYygwLjIsIDAuMDIsIDAuMDAyKSkKbnVtX2xvYWRpbmdzKGxkYV9sb2FkaW5ncykKYGBgCgo8L2RldGFpbHM+CgojIyMjIyA2LiBQbG90IHRoZSByZXN1bHRpbmcgc3BhcnNlIHNjb3JlcyBhZ2FpbnN0IHRoZSByZXNwb25zZS4gQXJlIHRoZSBzbWFsbGVyIHN1YnNldHMgb2YgZ2VuZXMgYXMgZWZmZWN0aXZlIGluIHNlcGFyYXRpbmcgdGhlIHR1bW91ciBhbmQgbm9ybWFsIHRpc3N1ZSBncm91cHMgYXMgdGhlIGVudGlyZSBzZXQgb2YgZ2VuZXM/IHstfQoKWW91IG1heSByZXVzZSB0aGUgY29kZSBmcm9tIHRhc2sgNCB0byBwcm9kdWNlIDMgbmV3IHBsb3RzLCBvbmUgZm9yIGVhY2ggY2hvaWNlIG9mICRcbGFtYmRhJC4gQ29tcGFyZSB0aGlzIHRvIHRoZSBwbG90IGZvciB0aGUgb3JpZ2luYWwgTERBIGZyb20gdGFzayA0IGFuZCBpbnRlcnByZXQuCgo8ZGV0YWlscz48c3VtbWFyeT5Tb2x1dGlvbjwvc3VtbWFyeT4KClVzaW5nIGJhc2UgYFJgIHBsb3R0aW5nOgoKYGBge3Igc3BhcnNlLUxEQS1wbG90cywgZmlnLndpZHRoID0gOX0KIyBIZWxwZXIgZnVuY3Rpb24gZm9yIHNjYXR0ZXJwbG90IGJldHdlZW4gdHdvIHNwYXJzZSBQQ3MKcGxvdF9zcGFyc2VfTERBIDwtIGZ1bmN0aW9uKGxvYWRpbmdzKSB7CiAgbl9ub256ZXJvIDwtIHN1bShsb2FkaW5nc1stMV0gIT0gMCkKICBTTERBIDwtIFggJSolIGxvYWRpbmdzWy0xXQoKICBib3hwbG90KAogICAgU0xEQSB+IFksIGNvbCA9IGNvbHMsIHlsYWIgPSAiWiIsCiAgICBtYWluID0gc3ByaW50ZigiU3Vic2V0IG9mICVkIGdlbmVzIiwgbl9ub256ZXJvKSwKICAgIHlsaW0gPSBjKC00LCA0KQogICkKfQoKcGFyKG1mcm93ID0gYygyLCAyKSkKYm94cGxvdCgKICBaMSB+IFksIGNvbCA9IGNvbHMsIHlsYWIgPSAiWiIsCiAgbWFpbiA9ICJFbnRpcmUgc2V0IG9mIDIwMDAgZ2VuZXMiLAogIHlsaW0gPSBjKC00LCA0KQopCnBsb3Rfc3BhcnNlX0xEQSgKICBhcy52ZWN0b3IoY29lZihsZGFfbG9hZGluZ3MsIHMgPSAwLjAwMikpCikKcGxvdF9zcGFyc2VfTERBKAogIGFzLnZlY3Rvcihjb2VmKGxkYV9sb2FkaW5ncywgcyA9IDAuMDIpKQopCnBsb3Rfc3BhcnNlX0xEQSgKICBhcy52ZWN0b3IoY29lZihsZGFfbG9hZGluZ3MsIHMgPSAwLjIpKQopCmBgYAoKQWx0ZXJuYXRpdmVseSwgdXNpbmcgYGdncGxvdGA6CgpgYGB7ciBzcGFyc2UtTERBLWdncGxvdHN9CiMgSGVscGVyIGZ1bmN0aW9uIGZvciBzY2F0dGVycGxvdCBiZXR3ZWVuIHR3byBzcGFyc2UgUENzCnBsb3Rfc3BhcnNlX0xEQSA8LSBmdW5jdGlvbihsb2FkaW5ncykgewogIG5fbm9uemVybyA8LSBzdW0obG9hZGluZ3NbLTFdICE9IDApCiAgU0xEQSA8LSBYICUqJSBsb2FkaW5nc1stMV0KCiAgZ2dwbG90KGRhdGEuZnJhbWUoU0xEQSwgWSksIGFlcyh4ID0gWSwgeSA9IFNMREEsIGZpbGwgPSBhcy5mYWN0b3IoWSkpKSArCiAgICBnZW9tX2JveHBsb3QoKSArCiAgICBzY2FsZV9maWxsX21hbnVhbCh2YWx1ZXMgPSBjb2xzKSArCiAgICBsYWJzKHggPSAiWSIsIHkgPSAiWiIsCiAgICAgIHRpdGxlID0gc3ByaW50ZigiU3Vic2V0IG9mICVkIGdlbmVzIiwgbl9ub256ZXJvKQogICAgKSArCiAgICB5bGltKC00LCA0KSArCiAgICB0aGVtZV9taW5pbWFsKCkgKwogICAgdGhlbWUobGVnZW5kLnBvc2l0aW9uID0gIm5vbmUiLCBwbG90LnRpdGxlID0gZWxlbWVudF90ZXh0KGhqdXN0ID0gMC41KSkgIAp9CgpwbG90MSA8LSBnZ3Bsb3QoZGF0YS5mcmFtZShaMSwgWSksIGFlcyh4ID0gWSwgeSA9IFoxLCBmaWxsID0gYXMuZmFjdG9yKFkpKSkgKwogIGdlb21fYm94cGxvdCgpICsKICBzY2FsZV9maWxsX21hbnVhbCh2YWx1ZXMgPSBjb2xzKSArCiAgbGFicyh4ID0gIlkiLCB5ID0gIloiLAogICAgdGl0bGUgPSAiRW50aXJlIHNldCBvZiAyMDAwIGdlbmVzIgogICkgKwogIHlsaW0oLTQsIDQpICsKICB0aGVtZV9taW5pbWFsKCkgKwogIHRoZW1lKGxlZ2VuZC5wb3NpdGlvbiA9ICJub25lIiwgcGxvdC50aXRsZSA9IGVsZW1lbnRfdGV4dChoanVzdCA9IDAuNSkpCnBsb3QyIDwtIHBsb3Rfc3BhcnNlX0xEQSgKICBhcy52ZWN0b3IoY29lZihsZGFfbG9hZGluZ3MsIHMgPSAwLjAwMikpCikKcGxvdDMgPC0gcGxvdF9zcGFyc2VfTERBKAogIGFzLnZlY3Rvcihjb2VmKGxkYV9sb2FkaW5ncywgcyA9IDAuMDIpKQopCnBsb3Q0IDwtIHBsb3Rfc3BhcnNlX0xEQSgKICBhcy52ZWN0b3IoY29lZihsZGFfbG9hZGluZ3MsIHMgPSAwLjIpKQopCgpnZ2FycmFuZ2UocGxvdDEsIHBsb3QyLCBwbG90MywgcGxvdDQpCmBgYAoKX19Db25jbHVzaW9uOl9fIFNwYXJzZSBMREEgcGVyZm9ybXMgYWxtb3N0IGlkZW50aWNhbGx5IHRvIHRoZSBvcmlnaW5hbCBMREEgaW4gc2VwYXJhdGluZyBub3JtYWwgYW5kIHR1bW91ciB0aXNzdWVzLiBFdmVuIHdpdGggb25seSB0aGUgMTggbW9zdCBpbXBvcnRhbnQgZ2VuZXMsIHRoZSBzcGFyc2UgTERBIGlzIG1vc3RseSBhYmxlIHRvIGRpc2NyaW1pbmF0ZSB0aGUgdHdvIGNsYXNzZXMgd2VsbC4KVGhlcmVmb3JlLCB0aGUgc2VwYXJhdGlvbiBiZXR3ZWVuIG5vcm1hbCBhbmQgdHVtb3VyIHRpc3N1ZXMgaXMgbWFpbmx5IGRyaXZlbiBieSBvbmx5IGEgc21hbGwgcHJvcG9ydGlvbiBvZiBnZW5lcy4KCjwvZGV0YWlscz4KCiMjIEJvbnVzOiBFdmFsdWF0aW9uIG9mIExEQSBhcyBhIHByZWRpY3RpdmUgY2xhc3NpZmllciB7LX0KCldlIHVzZSAxMC1mb2xkIGNyb3NzLXZhbGlkYXRpb24gdG8gZXZhbHVhdGUgdGhlIHByZWRpY3RpdmUgYWNjdXJhY3kgb2YgY2xhc3NpZmljYXRpb25zIGZyb20gdGhlIG9yaWdpbmFsIExEQSBvbiBhbGwgMjAwMCBnZW5lcyBhbmQgdGhlIFNMREEgb24gdGhlIHRocmVlIHNtYWxsZXIgc3Vic2V0cyBvZiBnZW5lcy4KCmBgYHtyIExEQS1DVn0Kc2V0LnNlZWQoOTE0NzUxKQoKIyBIZWxwZXIgZnVuY3Rpb24gdG8gY29tcHV0ZSBhY2N1cmFjeSBnaXZlbiB2LCBYLCBhbmQgWQpsZGFfYWNjdXJhY3kgPC0gZnVuY3Rpb24odiwgWCwgWSkgewogIHByZWRzIDwtIChYICUqJSB2KSA+IDAKICBvYnMgPC0gWSA9PSAidCIKICByZXR1cm4oMSAtIG1lYW4oYWJzKHByZWRzIC0gb2JzKSkpCn0KCmFjY19mdWxsIDwtIGFjY19zbWFsbCA8LSBhY2Nfc21hbGxlciA8LSBhY2Nfc21hbGxlc3QgPC0gTlVMTAoKIyBSYW5kb21seSBzcGxpdCB0aGUgZGF0YSBpbnRvIGsgZm9sZHMKZm9sZHMgPC0gc2FtcGxlKHJlcCgxOjEwLCBsZW5ndGgub3V0ID0gbGVuZ3RoKFkpKSkKCmZvciAoayBpbiAxOjEwKSB7CiAgIyBBc3NpZ24gdGhlIHRyYWluIGFuZCB2YWxpZGF0aW9uIHNldCBmb3IgdGhpcyBmb2xkCiAgdmFsX2lkeCA8LSB3aGljaChmb2xkcyA9PSBrKQogIHRyYWluX2lkeCA8LSBzZXRkaWZmKHNlcV9sZW4obGVuZ3RoKFkpKSwgdmFsX2lkeCkKICBYX3RyYWluIDwtIFhbdHJhaW5faWR4LCAsIGRyb3AgPSBGQUxTRV0KICBZX3RyYWluIDwtIFlbdHJhaW5faWR4XQogIFhfdmFsIDwtIFhbdmFsX2lkeCwgLCBkcm9wID0gRkFMU0VdCiAgWV92YWwgPC0gWVt2YWxfaWR4XQoKICAjIEZpdCB0aGUgTERBCiAgbGRhX2ZvbGQgPC0gbGRhKHggPSBYX3RyYWluLCBncm91cGluZyA9IFlfdHJhaW4pCiAgIyBGaXQgdGhlIFNMREEgd2l0aCB0aHJlZSBsZXZlbHMgb2Ygc3BhcnNpdHkKICBaX2ZvbGQgPC0gWF90cmFpbiAlKiUgbGRhX2ZvbGQkc2NhbGluZwogIGxhc3NvX2ZvbGQgPC0gZ2xtbmV0KFhfdHJhaW4sIFpfZm9sZCwgYWxwaGEgPSAxLCBsYW1iZGEgPSBjKDAuMiwgMC4wMiwgMC4wMDIpKQogICMgRXZhbHVhdGUgdGhlIGFjY3VyYWN5IG9mIGFsbCBmb3VyIG1vZGVscyBvbiB0aGUgdmFsaWRhdGlvbiBzZXQKICBhY2NfZnVsbCA8LSBjKGFjY19mdWxsLCBsZGFfYWNjdXJhY3kobGRhX2ZvbGQkc2NhbGluZywgWF92YWwsIFlfdmFsKSkKICBhY2Nfc21hbGwgPC0gYygKICAgIGFjY19zbWFsbCwKICAgIGxkYV9hY2N1cmFjeShhcy52ZWN0b3IoY29lZihsYXNzb19mb2xkLCBzID0gMC4wMDIpKVstMV0sIFhfdmFsLCBZX3ZhbCkKICApCiAgYWNjX3NtYWxsZXIgPC0gYygKICAgIGFjY19zbWFsbGVyLAogICAgbGRhX2FjY3VyYWN5KGFzLnZlY3Rvcihjb2VmKGxhc3NvX2ZvbGQsIHMgPSAwLjAyKSlbLTFdLCBYX3ZhbCwgWV92YWwpCiAgKQogIGFjY19zbWFsbGVzdCA8LSBjKAogICAgYWNjX3NtYWxsZXN0LAogICAgbGRhX2FjY3VyYWN5KGFzLnZlY3Rvcihjb2VmKGxhc3NvX2ZvbGQsIHMgPSAwLjIpKVstMV0sIFhfdmFsLCBZX3ZhbCkKICApCn0KCmRhdGEuZnJhbWUoCiAgTERBID0gYygib3JpZ2luYWwiLCAic3BhcnNlIiwgInNwYXJzZXIiLCAic3BhcnNlc3QiKSwKICBhY2N1cmFjeSA9IGMoCiAgICBtZWFuKGFjY19mdWxsKSwgbWVhbihhY2Nfc21hbGwpLCBtZWFuKGFjY19zbWFsbGVyKSwgbWVhbihhY2Nfc21hbGxlc3QpCiAgKQopCmBgYAoKIyBBZGRpdGlvbmFsIHJlc291cmNlcyB7LX0KLSBTZWN0aW9uIDQuMyAoTERBKSBhbmQgMTQuNS41IChTUENBKSBvZiBAZXNsLWJvb2sKLSBGb3IgYSBzaW1wbGUgZXhwbGFuYXRpb24gb2YgdGhlIGNvbmNlcHQgYW5kIGludGVycHJldGF0aW9uIG9mIExEQSAoYW5kIG90aGVyIHN0YXRpc3RpY2FsIG1ldGhvZHMpLCBoYXZlIGEgbG9vayBhdCA8aHR0cHM6Ly93d3cueW91dHViZS5jb20vd2F0Y2g/dj1helhDekk1N1lmYz4KCmBgYHtyLCBjaGlsZD0iX3Nlc3Npb24taW5mby5SbWQifQpgYGAKCiMgUmVmZXJlbmNlcyB7LX0K</div>
<div class="footer">
    <hr>
    This work is licensed under the <a href= "https://creativecommons.org/licenses/by-nc-sa/4.0">
    CC BY-NC-SA 4.0</a> licence.
</div>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeSourceEmbed("Lab4-Sparse-PCA-LDA.Rmd");
  window.initializeCodeFolding("show" === "show");
});
</script>

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>


</body>
</html>
